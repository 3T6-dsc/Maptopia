<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Maptopia TH - Heartopia System</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* RESET & BASE */
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; background: url('Heartopia.jpg') no-repeat center center fixed;
        background-size: cover; overflow: hidden; font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #map { height: 100vh;
        width: 100vw; opacity: 0; transition: opacity 2s ease; background: url('Heartopia.jpg') no-repeat center center !important; background-size: cover !important;
        }

        /* UI DESKTOP */
        #intro-screen { position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh; background: url('Heartopia.jpg') no-repeat center center; background-size: cover; z-index: 20000; display: flex;
        flex-direction: column; align-items: center; justify-content: center; transition: opacity 1s ease; padding: 20px; overflow: hidden;
        }
        #intro-screen::before { content: ""; position: absolute; top: 0; left: 0; width: 100%;
        height: 100%; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(5px); z-index: 1;
        }

        .official-link-text { position: relative; z-index: 20002; margin-bottom: 20px; font-size: 18px; color: #fff;
        text-decoration: none; font-weight: 900; background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(50,50,50,0.8)); padding: 12px 25px; border: 2px solid #d4af37; border-radius: 50px;
        transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1.5px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); text-align: center;
        }
        .official-link-text:hover { background: #d4af37; color: #3e2723;
        box-shadow: 0 0 20px rgba(212, 175, 55, 0.6); transform: scale(1.05);
        }

        #welcome-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 19000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(3px); animation: fadeIn 0.5s;
        }
        .welcome-content { background: white; width: 90%; max-width: 600px; padding: 30px; border-radius: 20px;
        border: 3px solid #d4af37; text-align: center; position: relative; box-shadow: 0 0 50px rgba(212, 175, 55, 0.3); max-height: 90vh; overflow-y: auto;
        }
        .welcome-header { font-size: 24px; font-weight: 900; color: #8b0000; margin-bottom: 15px; text-transform: uppercase;
        letter-spacing: 2px; border-bottom: 2px solid #d4af37; padding-bottom: 10px; }
        .welcome-text { text-align: left;
        font-size: 14px; line-height: 1.6; color: #333; margin-bottom: 10px; }
        .welcome-note { background: #fff3cd;
        border-left: 5px solid #d4af37; padding: 10px; margin: 10px 0; font-size: 13px; color: #856404; font-weight: bold;
        }
        .details-list { text-align: left; background: #f8f9fa; padding: 15px; border-radius: 12px;
        margin: 15px 0; font-size: 13px; border-left: 4px solid #d4af37; line-height: 1.5; color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .language-selector { display: flex; gap: 10px; align-items: center; justify-content: center; margin-bottom: 10px;
        }

        .heartopia-title { position: relative; font-size: 48px; text-align: center; font-weight: 900;
        margin-bottom: 20px; text-transform: uppercase; letter-spacing: 4px; background: linear-gradient(to bottom, #fff 20%, #d4af37 50%, #8b6b15 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 4px 10px rgba(0,0,0,0.8)); font-family: 'Arial Black', sans-serif; z-index: 20001; margin-top: 0;
        }

        .welcome-box { position: relative; width: 100%; max-width: 600px; padding: 40px 30px;
        background: rgba(0, 0, 0, 0.85); border: 2px solid #d4af37; border-radius: 25px; color: white; text-align: center; box-shadow: 0 0 40px rgba(0,0,0,0.7);
        z-index: 10; }
        .welcome-box p { font-size: 18px; margin-bottom: 30px;
        }

        .btn-container { display: flex; flex-direction: column; gap: 15px; align-items: center; width: 100%;
        }
        
        .btn-magic {
            width: 100%; max-width: 600px; white-space: nowrap; padding: 18px 25px;
            background: linear-gradient(45deg, #8b0000, #d4af37, #b8860b, #8b0000);
            background-size: 300% 300%;
            color: white; border: 2px solid #fff; border-radius: 50px;
            font-size: 18px; font-weight: 900; cursor: pointer;
            text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6), 0 0 10px rgba(139, 0, 0, 0.5);
            animation: gradientAnim 4s ease infinite, pulseGlow 2s infinite alternate;
            transition: transform 0.3s;
        }
        .btn-magic:hover { transform: scale(1.05); }

        @keyframes gradientAnim {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes pulseGlow {
            from { box-shadow: 0 0 20px rgba(212, 175, 55, 0.6); }
            to { box-shadow: 0 0 35px rgba(212, 175, 55, 1); }
        }

        .btn-rex { width: 100%; max-width: 320px; padding: 15px 20px;
        background: linear-gradient(135deg, #8b0000, #d4af37); color: white; border: 2px solid white; border-radius: 50px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s;
        text-transform: uppercase; letter-spacing: 1px; }
        .btn-rex:hover { transform: scale(1.02);
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.5); }
        
        .btn-lang-switch {
            width: 100%; padding: 8px 10px;
            background: linear-gradient(135deg, #333, #555); 
            color: #d4af37; 
            border: 1px solid #d4af37; 
            border-radius: 50px; 
            font-size: 11px; font-weight: bold; 
            text-decoration: none; display: inline-block;
            text-transform: uppercase; letter-spacing: 1px; 
            transition: 0.3s;
            text-align: center;
        }
        .btn-lang-switch:hover {
            background: #d4af37; color: #333;
        }

        /* MENU GAUCHE */
        .leaflet-control-layers { left: 20px !important;
        top: 20px !important; width: 160px !important; background: rgba(255, 255, 255, 0.98) !important; border-radius: 15px !important; padding: 10px !important; max-height: 85vh;
        overflow-y: auto !important; border: none !important; box-shadow: 0 4px 15px rgba(0,0,0,0.3) !important; transition: transform 0.3s ease;
        }
        #mobile-menu-toggle { display: none; position: fixed; top: 10px; left: 10px; z-index: 5000;
        background: #8b0000; color: white; border: 2px solid #d4af37; border-radius: 8px; padding: 10px; font-size: 24px; cursor: pointer;
        box-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        .accordion-title { color: white; padding: 10px;
        border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 5px; text-align: center; font-size: 11px; text-transform: uppercase;
        }
        .title-pnj { background: #8b0000; } .title-bus { background: #E3CC2D;
        } .title-shop { background: #9b59b6; } .title-lieux { background: #f39c12; } .title-poisson { background: #3498db; } .title-insecte { background: #2ecc71;
        } .title-animal { background: #6d4c41; }.title-bird { background: #E898F1; }
        .title-resource { background: #795548; }

        .accordion-content { display: none;
        margin-bottom: 10px; background: #fff; }
        .accordion-content.active { display: block;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 8px 5px;
            cursor: pointer;
            font-size: 11px;
            border-bottom: 1px solid #eee;
            color: #333;
            transition: background 0.2s;
        }
        .menu-item:hover { background: #f9f9f9; font-weight: bold;
        }
        .menu-item.active-resource { background: #d7ccc8; font-weight: bold; border-left: 4px solid #795548; }

        .collection-check {
            margin-right: 10px;
            accent-color: #d4af37;
            cursor: pointer;
            width: 15px;
            height: 15px;
        }

        /* L√âGENDE DROITE ET FEEDBACK */
        .ping-legend { position: fixed;
        right: 20px; top: 20px; width: 220px; background: rgba(0,0,0,0.9); border: 2px solid #d4af37; border-radius: 15px; padding: 15px; color: white; z-index: 1000;
        max-height: 65vh; display: flex; flex-direction: column; transition: transform 0.3s ease;
        }
        #mobile-legend-toggle { display: none; position: fixed; top: 10px; right: 10px; z-index: 5000;
        background: #d4af37; color: #333; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; align-items: center; justify-content: center; font-weight: bold;
        cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        .legend-langs { border-bottom: 1px solid #d4af37;
        padding-bottom: 10px; margin-bottom: 10px; }
        #legend-list { overflow-y: auto; margin-top: 10px; flex-grow: 1;
        min-height: 50px; }
        .legend-item { display: flex; flex-direction: column; background: rgba(255,255,255,0.1); margin-bottom: 5px;
        padding: 8px; border-radius: 6px; font-size: 12px; }
        .coord-box { background: rgba(0,0,0,0.5); padding: 4px;
        border-radius: 4px; font-family: monospace; font-size: 10px; color: #d4af37; border: 1px solid #555; user-select: all; text-align: center; margin-top: 5px;
        }
        .legend-guide { margin-top: 15px; padding-top: 10px; border-top: 1px solid #d4af37;
        }
        .guide-row { display: flex; align-items: center; margin-bottom: 5px; font-size: 11px; color: #ccc;
        }
        .guide-icon { font-size: 14px; margin-right: 8px; width: 20px; text-align: center;
        }
        .pc-only { display: block;
        }

        /* --- STYLES LIKE INTERNE --- */
        .rating-container { margin-top: 20px;
        padding-top: 15px; border-top: 1px dashed #555; text-align: center; }
        .like-section { display: flex;
        align-items: center; justify-content: center; gap: 10px; margin-top: 5px; }

        .like-btn-internal {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #d4af37;
            border-radius: 20px;
            padding: 8px 20px;
            font-size: 14px;
            font-weight: bold;
            color: #d4af37;
            cursor: pointer;
            display: flex;
            align-items: center; gap: 8px;
            transition: 0.3s;
            outline: none;
        }
        .like-btn-internal:hover { background: rgba(212, 175, 55, 0.2);
        }

        .heart-icon-anim { font-size: 18px;
        display: inline-block; }
        .like-btn-internal.liked {
            background: #d4af37;
            color: #3e2723;
            border-color: #d4af37;
            cursor: default;
            opacity: 0.8;
        }
        .like-btn-internal.liked:hover { transform: none; box-shadow: none;
        }

        .like-btn-internal.liked .heart-icon-anim {
            animation: none;
        }

        #like-count-internal { font-size: 14px;
        color: #fff; font-weight: bold; font-family: monospace; }

        /* Styles Carte */
        .label-ville { background: white !important;
        border: 2px solid #3498db !important; border-radius: 5px; padding: 2px 8px; font-weight: bold; font-size: 11px; color: #2980b9; white-space: nowrap;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .label-eau { background: rgba(41, 128, 185, 0.8) !important;
        border: 1px solid #fff !important; border-radius: 5px; padding: 2px 8px; font-size: 10px; color: white; font-weight: bold; white-space: nowrap;
        }
        .invisible-marker { background: transparent !important; border: none !important;
        }

        .pnj-icon { width: 35px !important; height: 35px !important; max-width: 35px !important;
        max-height: 35px !important; -webkit-backface-visibility: hidden; backface-visibility: hidden; transition: width 0.3s, height 0.3s;
        }
        .resource-icon { width: 30px !important; height: 30px !important; filter: drop-shadow(0 0 2px white);
        }
        .heartopia-popup .leaflet-popup-content-wrapper { background: rgba(255, 255, 255, 0.95); border: 2px solid #d4af37;
        border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); padding: 0; text-align: center;
        }
        .heartopia-popup .leaflet-popup-content { margin: 8px 12px; font-weight: 900; color: #8b0000; font-size: 14px;
        text-transform: uppercase; letter-spacing: 1px; font-family: 'Sarabun', sans-serif; }
        .heartopia-popup .leaflet-popup-tip { background: #d4af37;
        width: 12px; height: 12px; margin: -6px auto 0; box-shadow: none;
        }
        .heartopia-popup a.leaflet-popup-close-button { display: none;
        }

        /* --- SOCIAL & CONTACT BOX --- */
        #social-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 4000;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .social-btn-img { transition: transform 0.3s ease; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        cursor: pointer; }
        .social-btn-img:hover { transform: scale(1.1);
        }

        #discord-img { width: 65px;
        } 
        
        #contact-trigger {
            width: 65px;
            height: 65px;
            background: #8b0000;
            border: 2px solid #d4af37;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; color: white;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.6);
            transition: all 0.3s;
            order: 1;
        }
        #discord-link-wrapper { order: 2;
        }
        
        #contact-trigger:hover { transform: scale(1.1);
        background: #d4af37; color: #8b0000; }

        /* BOITE DE DIALOGUE SIMPLE */
        #simple-chat-box {
            display: none;
            position: fixed;
            bottom: 100px; 
            right: 20px;
            width: 300px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #d4af37;
            border-radius: 15px;
            z-index: 5000;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            font-family: 'Sarabun', sans-serif;
            overflow: hidden;
        }

        .chat-header {
            background: #8b0000;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 900;
            text-transform: uppercase;
            border-bottom: 2px solid #d4af37;
            display: flex; justify-content: space-between; align-items: center;
        }
        .close-chat { background: none; border: none; color: white; font-weight: bold; cursor: pointer;
        font-size: 18px; }

        .chat-form { padding: 15px; color: white;
        }
        .chat-label { font-size: 12px; color: #d4af37; margin-bottom: 5px; display: block; font-weight: bold;
        }
        .chat-input, .chat-textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            background: #222;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
            font-family: inherit;
        }
        .chat-textarea { height: 80px; resize: none;
        }

        .chat-submit {
            width: 100%;
            background: linear-gradient(135deg, #8b0000, #d4af37);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }
        .chat-submit:hover { opacity: 0.9;
        }

        #chat-status { text-align: center; font-size: 12px; margin-top: 10px; color: #aaa;
        }

        .chat-footer-mail {
            text-align: center;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #444;
            font-size: 11px;
            color: #aaa;
        }
        .chat-footer-mail a { color: #d4af37; text-decoration: none;
        }
        .chat-footer-mail a:hover { text-decoration: underline;
        }

        #overlay-info { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 30000; display: none; align-items: center; justify-content: center;
        }
        .info-card { background: white; padding: 25px; border-radius: 20px; border: 3px solid #d4af37;
        width: 450px; text-align: center; max-width: 95%; }
        .info-card img { width: 100%;
        display: block; margin: 0 auto; }
        .info-img-main { mix-blend-mode: multiply; margin-bottom: 10px;
        }

        .smooth-move { transition: transform 7s linear !important;
        }
        .albert-walk { transition: transform 2s linear !important;
        }
        .is-zooming .leaflet-marker-icon { transition: none !important;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1;
        } }

        /* --- MEDIA QUERIES --- */
        @media only screen and (min-width: 769px) {
            .pnj-icon { width: 35px !important;
            height: 35px !important; max-width: 35px !important; max-height: 35px !important; }
        }

        @media only screen and (max-width: 768px) {
            .pc-only { display: none !important;
            }
            .heartopia-title { font-size: 32px; letter-spacing: 2px;
            }
            .welcome-box { padding: 20px; width: 90%;
            }
            .official-link-text { font-size: 14px; padding: 10px 15px;
            width: 90%; display: inline-block; }
            #mobile-menu-toggle { display: block;
            }
            .leaflet-control-layers { transform: translateX(-200%); width: 220px !important;
            top: 60px !important; left: 10px !important; max-height: 70vh; }
            .leaflet-control-layers.mobile-visible { transform: translateX(0);
            }
            .menu-item { padding: 12px 10px; font-size: 14px;
            }
            .accordion-title { padding: 12px; font-size: 13px;
            }
            #mobile-legend-toggle { display: flex;
            }
            .ping-legend { transform: translateX(150%); width: 250px; top: 60px;
            right: 10px; }
            .ping-legend.mobile-visible { transform: translateX(0);
            }

            #social-container { bottom: 20px; right: 10px; gap: 8px;
            }
            #discord-img { width: 50px;
            } 
            #contact-trigger { width: 50px;
            height: 50px; font-size: 24px; }
            #simple-chat-box { width: 280px;
            bottom: 80px; right: 10px; }

            .welcome-content { padding: 15px;
            width: 95%; }
            .welcome-header { font-size: 20px;
            }
        }
        /* STYLE DU QUIZ REX */
        .quiz-section { margin-top: 15px;
        padding-top: 10px; border-top: 1px dashed #555; text-align: center; }
        #quiz-trigger {
            width: 55px;
            height: 55px; background: #f39c12; border: 2px solid #fff; border-radius: 50%;
            display: inline-flex; align-items: center; justify-content: center;
            font-size: 24px; color: white;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.6); transition: 0.3s;
        }
        #quiz-trigger:hover { transform: scale(1.1);
        background: #d4af37; }
        #quiz-container {
            display: none;
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 450px; background: white; border: 3px solid #d4af37;
            border-radius: 20px;
            padding: 25px; z-index: 35000; box-shadow: 0 0 100px rgba(0,0,0,0.8); text-align: center;
        }
        .quiz-option {
            display: block;
            width: 100%; padding: 12px; margin: 10px 0; background: #f8f9fa;
            border: 2px solid #eee; border-radius: 10px; cursor: pointer; font-weight: bold;
            color: #333; transition: 0.2s;
        }
        .quiz-option:hover { background: #fff3cd; border-color: #d4af37;
        }
    </style>
</head>
<body>
<div id="quiz-container">
    <div style="font-size: 40px; margin-bottom: 10px;">üéì</div>
    <h2 id="quiz-question" style="color: #8b0000; font-size: 20px; margin-top: 0;"></h2>
    <div id="quiz-options"></div>
    <p id="quiz-feedback" style="margin-top: 15px; font-weight: 900; font-size: 18px;"></p>
    <button onclick="closeQuiz()" style="margin-top: 15px; background: #8b0000; color: white; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; font-weight: bold;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
</div>

<audio id="main-audio"><source src="sonheartopia.mp4" type="audio/mp4"></audio>

<button id="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
<button id="mobile-legend-toggle" onclick="toggleMobileLegend()">üìå</button>

<div id="intro-screen">
    <a href="https://heartopia.xd.com/en" target="_blank" class="official-link-text" title="‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå Heartopia ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£">
        ‡∏•‡∏¥‡∏á‡∏Å‡πå Heartopia ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£
    </a>

    <h1 class="heartopia-title">MAPTOPIA TH</h1>
    <div class="welcome-box">
        <p>‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÅ‡∏≠‡∏Ñ‡∏ó‡∏µ‡∏ü‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ä‡∏∏‡∏°‡∏ä‡∏ô Heartopia</p>
        <div class="btn-container">
            <button id="enter-button" class="btn-magic" onclick="startExperience()">‚ú® ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‚ú®</button>
        </div>
    </div>
</div>

<div id="welcome-modal">
    <div class="welcome-content">
        <div class="welcome-header">‡∏ñ‡∏∂‡∏á‡∏ä‡∏≤‡∏ß HEARTOPIA</div>
        <div class="welcome-text">
            ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà <b>Maptopia</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏ß‡∏à Heartopia ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!<br>
         
            <div class="details-list">
                ‚Ä¢ <b>‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á:</b> ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î‡∏ó‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<br>
                <span class="pc-only">‚Ä¢ <b>‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡∏£‡πå‡∏Å:</b> <b>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡∏à‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br></span>
                ‚Ä¢ <b>‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô:</b> ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π "‡∏õ‡∏•‡∏≤", "‡πÅ‡∏°‡∏•‡∏á" ‡πÅ‡∏•‡∏∞ "‡∏ô‡∏Å" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>
                ‚Ä¢ <b>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£:</b> ‡πÉ‡∏´‡∏°‡πà! ‡πÇ‡∏ã‡∏ô‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° (‡πÑ‡∏°‡πâ, ‡πÅ‡∏£‡πà, ‡∏ú‡∏•‡πÑ‡∏°‡πâ) ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà<br>
                ‚Ä¢ <b>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</b> ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ üí¨ ‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô<br>
                ‚Ä¢ <b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏´‡∏≤‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà <b>maptopiafr@gmail.com</b><br>
                ‚Ä¢ <b>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</b> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            </div>

            <div class="welcome-note">
                üêæ <b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß:</b><br>
                ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏°‡∏°‡∏ï‡∏¥ ‡πÅ‡∏ï‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÇ‡∏ã‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏ß‡∏Å‡∏°‡∏±‡∏ô
                ‡∏≠‡∏±‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ï ‡∏à‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå ‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏Ñ‡∏∏‡∏ì
            </div>
            üõ†Ô∏è <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå:</b><br>
            ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤
            </div>
        <button class="btn-rex" onclick="closeWelcome()">‡πÑ‡∏õ‡∏•‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!</button>
    </div>
</div>

<div id="social-container">
    <div id="contact-trigger" onclick="toggleChat()">üí¨</div>

    <a href="https://discord.gg/M4BkXRhhUw" target="_blank" title="‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° Discord" id="discord-link-wrapper">
        <img src="Discord-Logo-PNG-Pic.png" id="discord-img" class="social-btn-img" alt="Discord">
    </a>
</div>

<div id="simple-chat-box">
    <div class="chat-header">
        <span>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô</span>
        <button class="close-chat" onclick="toggleChat()">X</button>
    </div>
    <div class="chat-form">
        <label class="chat-label">‡∏ä‡∏∑‡πà‡∏≠ DISCORD ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö)</label>
        <input type="text" id="user-name" class="chat-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô: Rex#1234">

        <label class="chat-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
        <textarea id="user-msg" class="chat-textarea" placeholder="‡∏°‡∏µ‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢? ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î? ‡∏ö‡∏≠‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢..."></textarea>

        <button class="chat-submit" onclick="sendToDiscord()">‡∏™‡πà‡∏á</button>
        <div id="chat-status"></div>

        <div class="chat-footer-mail">
            ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•: <a href="mailto:maptopiafr@gmail.com?subject=Contact%20Maptopia">maptopiafr@gmail.com</a>
        </div>
    </div>
</div>

<div class="ping-legend" id="legend-box">
  
    <div class="language-selector legend-langs" style="margin-bottom: 10px; display: flex; gap: 8px; justify-content: center;">
        <a href="index.html" class="btn-lang-switch">üåç ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤</a>
    </div>

    <div style="text-align:center;
    font-weight:bold; border-bottom:1px solid #d4af37; padding-bottom:5px; font-size:12px;">
        
    </div>
    
    <div style="text-align:center;
    font-weight:bold; border-bottom:1px solid #d4af37; padding-bottom:5px; font-size:12px;">üìå ‡∏°‡∏≤‡∏£‡πå‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</div>
    <div id="legend-list"></div>
    <div class="legend-guide">
        <div class="guide-row pc-only"><span class="guide-icon">üñ•Ô∏è</span><span><b>PC:</b> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤ = ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î</span></div>
        <div class="guide-row"><span class="guide-icon">üì±</span><span><b>‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠:</b> ‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏∏‡∏°‡∏ö‡∏ô‡∏ã‡πâ‡∏≤‡∏¢</span></div>
    </div>

    <div class="rating-container">
        <div class="like-section">
            <button id="like-btn-internal" class="like-btn-internal" onclick="toggleLikeInternal()">
                <span class="heart-icon-anim">‚ù§</span> ‡∏â‡∏±‡∏ô‡∏ä‡∏≠‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ
            </button>
            <span id="like-count-internal">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
        </div>
        <p style="font-size:9px;
        color:#777; margin-top:5px;">(‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô!)</p>
    </div>
    <div class="quiz-section">
        <p style="font-size:10px;
        color:#aaa; margin-bottom:5px; text-align:center;">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        <div style="display: flex;
        justify-content: center;">
            <div id="quiz-trigger" onclick="openQuiz()">üéì</div>
        </div>
    </div>
</div>

<div id="map"></div>

<div id="overlay-info" onclick="this.style.display='none'" style="display:none;
    position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:10000; justify-content:center; align-items:center;">
    <div class="info-card" onclick="event.stopPropagation()" style="background:white; padding:5px; border-radius:50px; width:95%; max-width:530px;
    text-align:center; max-height: 90vh; overflow-y: auto;">

        <h2 id="info-name" style="color:#8b0000; margin-top:0; text-transform:uppercase;
        border-bottom: 2px solid #d4af37; padding-bottom: 5px;"></h2>

        <div style="display: flex; gap: 10px; margin-bottom: 15px;
        justify-content: center;">
            <div style="flex: 1;">
                <p style="font-size: 10px;
                font-weight: bold; margin-bottom: 5px;">‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</p>
                <img id="info-weather" src="" style="width:100%;
                border-radius:8px; border: 1px solid #eee;">
            </div>
            <div style="flex: 1;">
                <p style="font-size: 10px;
                font-weight: bold; margin-bottom: 5px;">‡πÄ‡∏ß‡∏•‡∏≤</p>
                <img id="info-time" src="" style="width:100%;
                border-radius:8px; border: 1px solid #eee;">
            </div>
        </div>

        <div style="width: 100%;
        margin-top: 10px;">
            <p style="font-size: 10px; font-weight: bold;
            margin-bottom: 5px;">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö</p>
            <img id="info-loc" src="" style="width:100%;
            max-width: 550px; border-radius:12px; border: 2px solid #d4af37; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
        </div>

        <button onclick="document.getElementById('overlay-info').style.display='none'" style="margin-top:20px;
        padding:12px 30px; cursor:pointer; background:#8b0000; color:white; border:none; border-radius:50px; font-weight:bold; text-transform:uppercase;">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<script>
    // --- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á (API ‡∏ü‡∏£‡∏µ) + DISCORD WEBHOOK ---

    const COUNT_API_NAMESPACE = 'maptopia_heartopia_fr_v1';
    const COUNT_API_KEY = 'likes';
    const COUNT_API_URL_GET = `https://api.counterapi.dev/v1/${COUNT_API_NAMESPACE}/${COUNT_API_KEY}/up`;
    const COUNT_API_URL_READ = `https://api.counterapi.dev/v1/${COUNT_API_NAMESPACE}/${COUNT_API_KEY}/`;

    function initLikeSystem() {
        const likeBtn = document.getElementById('like-btn-internal');
        const likeCountSpan = document.getElementById('like-count-internal');

       
        // 1. ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        fetch(COUNT_API_URL_READ)
            .then(res => res.json())
            .then(data => {
                likeCountSpan.innerText = data.count || 842;
            })
            .catch(() => {
                likeCountSpan.innerText = "842";
            });
        // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏¢‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ
        const isLiked = localStorage.getItem('maptopia_user_liked') === 'true';
        if(isLiked) {
            // ‡∏´‡∏≤‡∏Å‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            lockLikeButton(likeBtn);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å
        window.toggleLikeInternal = function() {
            // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô: ‡∏´‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏°‡∏µ‡∏Ñ‡∏•‡∏≤‡∏™ 'liked' ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
            if (likeBtn.classList.contains('liked')) return;

            // ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏ß‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
            lockLikeButton(likeBtn);
            // ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            localStorage.setItem('maptopia_user_liked', 'true');
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å

            // A. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å
            fetch(COUNT_API_URL_GET)
                .then(res => res.json())
                .then(data => {
                    likeCountSpan.innerText = data.count;
          
                });

            // B. ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Discord
            sendLikeToDiscord();
        };
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏π‡∏ó‡∏¥‡∏•‡∏¥‡∏ï‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
    function lockLikeButton(btn) {
        btn.classList.add('liked');
        btn.innerHTML = '<span class="heart-icon-anim">‚ù§</span> ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì!';
        btn.title = "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß!";
        btn.style.cursor = "default";
    }

    function sendLikeToDiscord() {
        const payload = {
            username: "Maptopia Votes",
            content: "‚ù§Ô∏è **‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏ñ‡∏π‡∏Å‡πÉ‡∏à‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà!**"
        };
        fetch(DISCORD_WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        }).catch(console.error);
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ú‡πà‡∏≤‡∏ô WEBHOOK ---
    const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1453916227893334130/_yGCAjF1nsfVQwq3C1M4lWs8STwa26zdusGW__nIeQIEl-TJehlQaf7kvEJJFdoLh1y6";
    function toggleChat() {
        const box = document.getElementById('simple-chat-box');
        box.style.display = (box.style.display === 'flex') ?
        'none' : 'flex';
    }

    function sendToDiscord() {
        const name = document.getElementById('user-name').value.trim();
        const msg = document.getElementById('user-msg').value.trim();
        const status = document.getElementById('chat-status');
        const userLang = navigator.language || navigator.userLanguage;
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤

        if(name === "" || msg === "") {
            status.innerText = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô";
            status.style.color = "#ff5555";
            return;
        }

        status.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
        status.style.color = "#aaa";
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Discord ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤
        const payload = {
            username: "Maptopia Contact",
            content: `**‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà!**\nüë§ **‡∏à‡∏≤‡∏Å:** ${name}\nüåç **‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö:** ${userLang}\nüí¨ **‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:**\n${msg}`
        };
        fetch(DISCORD_WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        })
            .then(response => {
                if(response.ok) {
                  
                    status.innerText = "‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                    status.style.color = "#55ff55";
                    document.getElementById('user-msg').value = "";
                    setTimeout(() => { toggleChat(); status.innerText = ""; }, 2000);
                } else {
  
                    status.innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á";
                    status.style.color = "#ff5555";
                }
            })
            .catch(err => {
             
                 console.error(err);
                status.innerText = "‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î";
                status.style.color = "#ff5555";
            });
    }

    // --- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡πÄ‡∏Å‡∏°) ---
    function toggleMobileMenu() {
        const menu = document.getElementById('main-menu');
        menu.classList.toggle('mobile-visible');
        if(menu.classList.contains('mobile-visible')) document.getElementById('legend-box').classList.remove('mobile-visible');
    }
    function toggleMobileLegend() {
        const legend = document.getElementById('legend-box');
        legend.classList.toggle('mobile-visible');
        if(legend.classList.contains('mobile-visible')) document.getElementById('main-menu').classList.remove('mobile-visible');
    }

    const colors = { rouge: '#e74c3c', bleu: '#3498db', vert: '#2ecc71', jaune: '#f1c40f', violet: '#9b59b6', orange: '#e67e22' };
    const icons = { note: 'üìå', fish: 'üé£', bird: 'ü¶ú', bug: 'ü¶ã', wood: 'üå≤', stone: '‚õ∞Ô∏è' };
    const albertPath = [[-532.4, 634.8], [-538.4, 635.8], [-543.3, 636.4], [-548.4, 637.8], [-554.5, 638.1], [-559.1, 638.1], [-564.8, 637.8], [-568, 637.3], [-571.9, 636.4], [-576.3, 634.5], [-581.5, 632.5], [-585.8, 630.3], [-591, 627.9], [-593.6, 626], [-598, 623.9], [-602.5, 621.3], [-606.6, 618.8], [-610.5, 616.5], [-614.6, 614.3], [-618.4, 611.6], [-622.6, 608.4], [-625.9, 605.8], [-628.9, 603.4], [-631, 600.4], [-631.8, 597.1], [-633.3, 593.6], [-634.3, 589.9], [-637.3, 588.4], [-639.1, 586.5], [-640.6, 584], [-641.3, 581.4], [-640.9, 578], [-640.4, 575.6], [-639.3, 572.8], [-638.3, 570.1], [-636, 565.4], [-634.4, 562.1], [-633.5, 558.5], [-633.1, 555.9], [-633.3, 552.8], [-633.3, 549.1], [-633.3, 546.8], [-633.3, 543.3], [-633.4, 533.9], [-633, 526.6], [-632.6, 521.5], [-632.4, 516.8], [-631.9, 510.4], [-631.9, 
    505.5], [-631.5, 502], [-631.3, 497], [-631.1, 492], [-630.6, 487.1], [-630.6, 480.8], [-630.9, 473.1], [-631.1, 465.6], [-631.9, 458.1], [-632.3, 452.9], [-633.1, 447.4], [-633.4, 442], [-634, 436.3], [-634.1, 431.3], [-634.3, 428.4], [-634.1, 425.4], [-633.9, 422.1], [-633, 419.6], [-632.1, 417.5], [-629.4, 413.1], [-627.4, 411], [-625.3, 408.5], [-622.6, 406.4], [-620.6, 405], [-618.5, 403.3], [-616.1, 401.5], [-614, 399.9], [-612.1, 397.8], [-611.3, 396.6], [-612, 392.4], [-612.5, 391], [-613.9, 387.9], [-614.1, 385], [-614.6, 380.6], [-614.1, 376.8], [-613.4, 373.1], [-612.4, 369.9], [-610.8, 366], [-609.3, 363.9], [-607.3, 360.8], [-604.6, 358], [-602.9, 356], [-599.6, 353.8], [-596.8, 351.3], [-593.3, 349.5], [-590.8, 348], [-588, 346.8], [-585.6, 345.8], [-579.9, 343.5], [-571.5, 340.4], [-565.1, 
    339], [-561.1, 338.1], [-556.6, 337.5], [-553.5, 337], [-548, 336.6], [-544.3, 336.5], [-541, 337], [-536.4, 337.4], [-533.3, 337.6], [-529.1, 338.5], [-526.3, 338.8], [-523.1, 339.5], [-519.3, 340.3], [-513.6, 341.6], [-510, 342.4], [-504.4, 343.3], [-500, 344], [-497.6, 344.8], [-492.4, 345.1], [-487.9, 345.4], [-483.6, 345.8], [-480.1, 345.5], [-477.4, 345.5], [-471, 345], [-466, 344.4], [-462.4, 341.8], [-459, 340.3], [-456.1, 339], [-451.6, 337.4], [-448.5, 335.5], [-444.3, 332.9], [-438.4, 331.3], [-433.5, 329.6], [-428.6, 327.9], [-425.6, 326.9], [-420, 325.6], [-415.3, 324.6], [-407.6, 324.1], [-402.4, 324.1], [-397.6, 324.4], [-392.1, 324.9], [-388, 325.5], [-384, 327.1], [-380.5, 328.5], [-377.5, 330], [-374.3, 332], [-370.3, 334], [-366.1, 336.1], [-362.8, 339.1], [-359.5, 342.4], [-356.3, 
    345.8], [-353.6, 349.6], [-351, 352.5], [-349.3, 356.9], [-346.9, 361.3], [-345, 366], [-343.6, 370.1], [-341.9, 376.1], [-341.4, 380.8], [-340.8, 385.3], [-340.1, 390.9], [-339.5, 394.4], [-339.4, 400], [-339.5, 404], [-340.1, 409.9], [-340.9, 415.4], [-341.8, 420.5], [-342.5, 425.4], [-344.1, 432], [-345.4, 436.6], [-347.6, 441.6], [-350, 446], [-352.4, 450.5], [-354.4, 455], [-356.8, 459], [-359.1, 463.1], [-361.1, 468.3], [-363.5, 473.5], [-365, 477.1], [-367.3, 481.3], [-369.8, 487], [-370.9, 492.1], [-373.1, 498.4], [-374.6, 506.4], [-375.1, 511.3], [-375.6, 516.4], [-376.4, 522.8], [-376.9, 531], [-377, 537.1], [-377, 541.9], [-377, 548.3], [-376.6, 552.8], [-376.5, 557.5], [-376, 564.1], [-375, 571.3], [-374.8, 576.3], [-373.6, 581.1], [-373.9, 584.4], [-374.1, 590], [-374.4, 594.8], [-375.3, 
    599.3], [-376, 602.1], [-377.6, 605.5], [-379, 608.3], [-380.4, 610.4], [-382.1, 612.6], [-384.3, 615.8], [-387.1, 618.6], [-389.1, 620.8], [-391.6, 622.5], [-395.8, 626], [-400.3, 629], [-405, 631.8], [-409.6, 634.9], [-415, 637.1], [-419.8, 639.5], [-424.3, 641.5], [-426.5, 642.8], [-429.6, 643.6], [-432.8, 644.3], [-436.6, 645], [-439.6, 645.3], [-443.5, 645.4], [-448.5, 645.4], [-455.8, 645.3], [-461.4, 645], [-470.5, 645], [-476.3, 645.1], [-481.5, 644.9], [-485.6, 644.8], [-489.5, 644.8], [-493.6, 644.6], [-499.6, 645], [-503.5, 645], [-508.3, 645], [-512, 645], [-515.4, 645], [-518.1, 645], [-520.8, 644.8], [-523.9, 643.4], [-526.1, 642.5], [-527.8, 641], [-530, 638.6], [-530.6, 636.8], [-531.5, 635.6]];
    function startExperience() {
        document.getElementById('main-audio').play().catch(() => {});
        document.getElementById('intro-screen').style.opacity = '0';
        document.getElementById('map').style.opacity = '1';
        setTimeout(() => {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('welcome-modal').style.display = 'flex';
        }, 800);
    }
    function closeWelcome() { document.getElementById('welcome-modal').style.display = 'none';
    }

    var bounds = [[-1000, 0], [0, 1000]];
    var map = L.map('map', { crs: L.CRS.Simple, minZoom: 0, maxZoom: 3, zoom: 1, zoomControl: false, maxBounds: bounds, maxBoundsViscosity: 1.0 });
    L.imageOverlay('carte.png', bounds).addTo(map);
    map.setView([-500, 500], 1);
    map.on('zoomstart', () => { document.body.classList.add('is-zooming'); });
    map.on('zoomend', () => { document.body.classList.remove('is-zooming'); });
    var userPings = JSON.parse(localStorage.getItem('maptopia_pings')) || [];
    var pingMarkers = {};
    var tempPingMarker = null;
    function createFinalMarker(p) {
        var markerHtml = `<div style="background:${colors[p.color]};width:28px;height:28px;border:2px solid white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;">${icons[p.icon]}</div>`;
        var marker = L.marker(p.latlng, {icon: L.divIcon({className:'', html:markerHtml, iconSize:[28,28], iconAnchor:[14,14]})}).addTo(map);
        marker.bindPopup(`<div style="text-align:center;"><b>${p.text}</b><br><div class="coord-box">${p.latlng.lat.toFixed(1)}, ${p.latlng.lng.toFixed(1)}</div><button onclick="removeUserPing('${p.id}')" style="width:100%; background:#e74c3c; color:white; border:none; padding:5px; margin-top:5px; cursor:pointer; border-radius:3px;">‡∏•‡∏ö</button></div>`);
        pingMarkers[p.id] = marker;
    }

    map.on('contextmenu', (e) => {
        if(tempPingMarker) map.removeLayer(tempPingMarker);
        var mid = "temp_" + Date.now();
        var tempHtml = `<div style="background:gray;width:28px;height:28px;border:2px dashed white;border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:0.7;">?</div>`;
        tempPingMarker = L.marker(e.latlng, {icon: L.divIcon({className:'', html:tempHtml, iconSize:[28,28], iconAnchor:[14,14]})}).addTo(map);
        tempPingMarker.tempColor = 'bleu';
        var div = document.createElement('div');
        div.style.minWidth = "180px";
        
        div.innerHTML = `<b style="display:block;margin-bottom:5px;text-align:center;">‡∏°‡∏≤‡∏£‡πå‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà</b><input type="text" id="in-${mid}" placeholder="‡∏ä‡∏∑‡πà‡∏≠..." style="width:100%; padding:5px; margin-bottom:10px; box-sizing:border-box;"><div style="display:flex; gap:5px; margin-bottom:10px; justify-content:center;">${Object.entries(colors).map(([k,v]) => `<div style="background:${v}; width:20px;
        height:20px; border-radius:50%; cursor:pointer; border:1px solid transparent;" onclick="selectPingColor('${k}', this)"></div>`).join('')}</div><button onclick="confirmPing('${mid}',${e.latlng.lat},${e.latlng.lng})" style="width:100%; background:#27ae60; color:white; border:none; padding:8px; cursor:pointer; border-radius:4px; font-weight:bold;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button><button onclick="cancelPing()" style="width:100%; background:#95a5a6;
        color:white; border:none; padding:5px; cursor:pointer; border-radius:4px; margin-top:5px; font-size:10px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>`;
        tempPingMarker.bindPopup(div, {closeOnClick: false}).openPopup();
    });

    window.selectPingColor = (c, el) => { tempPingMarker.tempColor = c; el.parentElement.querySelectorAll('div').forEach(d => d.style.borderColor='transparent'); el.style.borderColor='black'; };
    window.cancelPing = () => { if(tempPingMarker) { map.removeLayer(tempPingMarker); tempPingMarker = null; } };
    window.confirmPing = (mid, lat, lng) => {
        var v = document.getElementById('in-'+mid).value || "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà";
        var id = "id_"+Date.now();
        var newPing = {id:id, latlng:{lat,lng}, 
        text:v, color:tempPingMarker.tempColor, icon:'note'};
        userPings.push(newPing);
        localStorage.setItem('maptopia_pings', JSON.stringify(userPings));
        map.removeLayer(tempPingMarker);
        tempPingMarker = null;
        createFinalMarker(newPing);
        updateUserLegend();
    };
    window.removeUserPing = (id) => { if(pingMarkers[id]) map.removeLayer(pingMarkers[id]);
    userPings = userPings.filter(p => p.id != id); localStorage.setItem('maptopia_pings', JSON.stringify(userPings)); updateUserLegend(); };
    function updateUserLegend() {
        const list = document.getElementById('legend-list'); list.innerHTML = "";
        userPings.forEach(p => {
            const div = document.createElement('div'); div.className='legend-item';
            div.innerHTML = `<div style="width:100%; display:flex; justify-content:space-between; align-items:center;"><span onclick="map.flyTo([${p.latlng.lat},${p.latlng.lng}], 2)" style="cursor:pointer;">${icons[p.icon]} ${p.text}</span><button onclick="removeUserPing('${p.id}')" style="background:none; border:none; color:white; cursor:pointer; font-weight:bold;">X</button></div><div class="coord-box">${p.latlng.lat.toFixed(1)}, ${p.latlng.lng.toFixed(1)}</div>`;
            list.appendChild(div);
        });
    }

    var dataStorage = { pnj:[], bus:[], shop:[], lieux:[], animal:[], resource:[] };
    var currentSingleMarker = null;
    function triggerMovement(item) {
        if (!map.hasLayer(item.marker)) return;
        if(item.marker._icon) item.marker._icon.classList.add('smooth-move');
        let newLat = item.pos[0] + (Math.random() - 0.5) * (item.radius / 1.5);
        let newLng = item.pos[1] + (Math.random() - 0.5) * (item.radius / 1.5);
        item.marker.setLatLng([newLat, newLng]);
        item.moveTimer = setTimeout(() => triggerMovement(item), 7000);
    }
    function startAlbertPatrol(marker, index) {
        if (!map.hasLayer(marker)) return;
        if(marker._icon) { marker._icon.classList.remove('smooth-move'); marker._icon.classList.add('albert-walk'); }
        let nextIndex = (index + 1) % albertPath.length;
        let nextPos = albertPath[nextIndex];
        marker.setLatLng(nextPos);
        marker.moveTimer = setTimeout(() => { startAlbertPatrol(marker, nextIndex); }, 2000);
    }
    function register(cat, pos, name, img, opts = {}) {
        let m;
        var iSize;
        if (cat === 'pnj') iSize = [35,35];
        else if (cat === 'resource') iSize = [30,30]; 
        else iSize = [60,60];

        var iAnchor;
        if (cat === 'pnj') iAnchor = [17,17];
        else if (cat === 'resource') iAnchor = [15,15]; 
        else iAnchor = [30,60];

        var customClass = (cat === 'pnj') ? 'pnj-icon' : '';
        if(cat === 'pnj' && window.innerWidth <= 768) img = img.replace('pnj/', 'pnjmobil/');
        
        if(opts.type) { 
            m = L.marker(pos, { icon: L.divIcon({ className: 'invisible-marker', html: '', iconSize: [1, 1] }) }).bindTooltip(name, { permanent: true, direction: 'center', className: opts.type });
            if(opts.startOn) m.addTo(map); 
        } else {
            // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£: ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û PNG ‡∏à‡∏≤‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå resource (path ‡∏†‡∏≤‡∏©‡∏≤‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™‡πÄ‡∏î‡∏¥‡∏°)
            if (cat === 'resource') {
                 m = L.marker(pos, { icon: L.icon({ iconUrl: img, iconSize: iSize, className: 'resource-icon' }) });
            } else {
                 m = L.marker(pos, { icon: L.icon({ iconUrl: img, iconSize: iSize, iconAnchor: iAnchor, className: customClass }) });
            }

            if(cat === 'pnj') { 
                var popupContent = `<div class='heartopia-popup'>${name}</div>`; 
                var customOptions = { className: 'heartopia-popup', closeButton: false, offset: [0, -10] };
                m.bindPopup(popupContent, customOptions); 
            } else if(cat !== 'bus' && cat !== 'shop' && cat !== 'resource') { 
                m.bindPopup(`<b>${name}</b>`);
            }
            
            if(opts.startOn || cat === 'pnj') m.addTo(map);
        }
        dataStorage[cat].push({name, pos, marker:m, category:cat, radius: opts.radius || 50, moveTimer: null});
    }

    [[-471,501,"‡∏ö‡πä‡∏≠‡∏ö","pnj/bob.png"],[-526,499,"‡∏≠‡∏≤‡∏ó‡∏≤‡∏£‡∏≤","pnj/atara.png"],[-478,493,"‡∏ô‡∏±‡∏Å‡∏™‡∏∞‡∏™‡∏°","pnj/collectioneur.png"],[-469,488,"‡πÇ‡∏î‡πÇ‡∏£‡∏ò‡∏µ","pnj/doroth√©e.png"],[-496.4, 520.6,"‡∏°‡∏±‡∏™‡∏™‡∏¥‡πÇ‡∏°","pnj/massimo.png"],[-412,418,"‡∏Å‡∏≤‡∏ä‡∏¥‡∏á","pnj/ka ching.png"],[-399,591,"‡πÅ‡∏≠‡∏ô‡∏î‡∏£‡∏π‡∏ß‡πå","pnj/andrew.png"],[-259,522,"‡πÄ‡∏≠‡∏£‡∏¥‡∏Ñ","pnj/eric.png"],[-456,549,"‡∏ß‡∏≤‡∏ô‡∏¢‡πà‡∏≤","pnj/vanya.png"],[-502,582,"‡∏ô‡∏≤‡∏ô‡∏¥‡∏ß‡∏∞","pnj/niniwa.png"],[-502,519,"‡πÇ‡∏à‡∏ô","pnj/joa.png"],[-807,419,"‡∏ß‡∏¥‡∏•‡∏•‡πå","pnj/will.png"],[-355,809,"‡πÅ‡∏û‡∏ï‡∏ï‡∏µ‡πâ","pnj/patti.png"],[-653,225,"‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πà","pnj/vernie.png"],[-498,526,"‡πÄ‡∏ö‡∏•‡∏µ‡∏¢‡πå","pnj/bayley.png"],[-528.3,560.3,"‡∏ö‡∏•‡∏≠‡∏á","pnj/blanc.png"],[-499.8,499.0,"‡πÅ‡∏≠‡∏ô‡∏ô‡∏µ‡πà","pnj/annie.png"],[-532.4, 634.8, "‡∏≠‡∏±‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ï ‡∏à‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå", "pnj/albert jr.png"]].forEach(d => register('pnj', [d[0],d[1]], d[2], d[3]));
    [ ["‡∏ä‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å",[-533,340]], ["‡∏ä‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô",[-519,639]], ["‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏°‡∏á",[-654,479]], ["‡∏ó‡∏∏‡πà‡∏á‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ",[-532,218]], ["‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏ö‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏û‡∏∏‡∏£‡πâ‡∏≠‡∏ô",[-222,512]], ["‡∏ä‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",[-373,480]], ["‡∏•‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡∏≠‡∏á",[-497,481]], ["‡∏õ‡πà‡∏≤",[-500,798]]].forEach(b => register('bus', b[1], b[0], 'bus.png', {startOn: true}));
    [[-472,487,"‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤","vetement.png"],[-474,503,"‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå","Meuble.png"],[-496.4, 520.6,"‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á","chien.png"],[-440,467,"‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠","Librairie.png"]].forEach(s => register('shop', [s[0],s[1]], s[2], s[3]));
    register('animal', [-691, 783], "‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤", "panda.png", {radius: 60}); register('animal', [-184, 291], "‡∏Ñ‡∏≤‡∏õ‡∏¥‡∏ö‡∏≤‡∏£‡πà‡∏≤", "capybara.png", {radius: 50});
    register('animal', [-533, 340], "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢", "lapin.png", {radius: 40}); register('animal', [-649, 185], "‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å", "renard.png", {radius: 70});
    register('animal', [-692, 506], "‡∏ô‡∏≤‡∏Å", "loutre.png", {radius: 40}); register('animal', [-737, 512], "‡∏°‡∏¥‡πâ‡∏á‡∏Ñ‡πå", "vison.png", {radius: 10});
    register('animal', [-531, 805], "‡∏Å‡∏ß‡∏≤‡∏á", "cerf.png", {radius: 60}); register('animal', [-725, 208], "‡∏•‡∏≤‡∏°‡∏∞", "lama.png", {radius: 50});
    
    // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏• (‡πÑ‡∏ó‡∏¢)
    [{pos:[-538,492], name:"‡∏•‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡∏≠‡∏á", type:"label-ville", startOn:true}, {pos:[-692,506], name:"‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏°‡∏á", type:"label-ville", startOn:true}, {pos:[-438,513], name:"‡∏ñ‡∏ô‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢", type:"label-ville", startOn:true}, {pos:[-649,185], name:"‡∏ó‡∏∏‡πà‡∏á‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ", type:"label-ville", startOn:true}, {pos:[-440,184], name:"‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏õ‡∏•‡∏≤‡∏ß‡∏≤‡∏¨", type:"label-ville", startOn:true}, {pos:[-184,291], name:"‡∏ã‡∏≤‡∏Å‡∏õ‡∏£‡∏±‡∏Å‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏á", type:"label-ville", startOn:true}, {pos:[-223,501], name:"‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏ö‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏û‡∏∏‡∏£‡πâ‡∏≠‡∏ô", type:"label-ville", startOn:true}, {pos:[-228,627], name:"‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏≤‡∏´‡∏¥‡∏ô", type:"label-ville", startOn:true}, {pos:[-531,805], name:"‡∏õ‡πà‡∏≤‡πÇ‡∏≠‡πä‡∏Ñ", type:"label-ville", startOn:true}, {pos:[-494,429], name:"‡∏ñ‡∏ô‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏∞", type:"label-ville", startOn:true}, {pos:[-510,558], name:"‡∏ñ‡∏ô‡∏ô‡∏™‡∏ß‡∏ô", type:"label-ville", startOn:true}, {pos:[-736,602], name:"‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å", type:"label-ville", startOn:true}, {pos:[-690,402], name:"‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠", type:"label-ville", startOn:true}, {pos:[-780,387], name:"‡∏õ‡∏£‡∏∞‡∏†‡∏≤‡∏Ñ‡∏≤‡∏£", type:"label-ville", startOn:true}, {pos:[-691,783], name:"‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ô‡πâ‡∏≥", type:"label-ville", startOn:true}, {pos:[-338,933], name:"‡πÄ‡∏Å‡∏≤‡∏∞‡∏õ‡πà‡∏≤", type:"label-ville", startOn:true}, {pos:[-587,406], name:"‡∏ä‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á", 
    type:"label-ville", startOn:true}, {pos:[-725,208], name:"‡∏´‡∏≤‡∏î‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á", type:"label-ville", startOn:true}, {pos:[-783,478], name:"‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏á‡∏ö", type:"label-eau", startOn:true}, {pos:[-534,92], name:"‡∏ó‡∏∞‡πÄ‡∏•‡∏õ‡∏•‡∏≤‡∏ß‡∏≤‡∏¨", type:"label-eau", startOn:true}, {pos:[-68,497], name:"‡∏ó‡∏∞‡πÄ‡∏•‡πÇ‡∏ö‡∏£‡∏≤‡∏ì", type:"label-eau", startOn:true}, {pos:[-536,232], name:"‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏ó‡∏∏‡πà‡∏á‡∏´‡∏ç‡πâ‡∏≤", type:"label-eau", startOn:true}, {pos:[-337,319], name:"‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏≠‡∏≠‡πÇ‡∏£‡∏£‡∏≤", type:"label-eau", startOn:true}, {pos:[-176,394], name:"‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÑ‡∏ü", type:"label-eau", startOn:true}, {pos:[-265,537], name:"‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏ö‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏û‡∏∏‡∏£‡πâ‡∏≠‡∏ô", type:"label-eau", startOn:true}, {pos:[-344,652], name:"‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ï‡∏∑‡πâ‡∏ô", type:"label-eau", startOn:true}, {pos:[-598,748], name:"‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏õ‡πà‡∏≤", type:"label-eau", startOn:true}, {pos:[-431,774], name:"‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏õ‡πà‡∏≤‡∏™‡∏π‡∏á", type:"label-eau", startOn:true}, {pos:[-608,481], name:"‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏ä‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á", type:"label-eau", startOn:true}, {pos:[-669,368], name:"‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏µ‡∏¢‡∏ö", type:"label-eau", startOn:true}, {pos:[-674,627], name:"‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏¢‡∏±‡∏Å‡∏©‡πå", type:"label-eau", startOn:true}, {pos:[-600,600], name:"‡∏ó‡∏∏‡πà‡∏á‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°", type:"label-ville", startOn:true}, {pos:[-670,450], name:"‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å", type:"label-ville", startOn:true}].forEach(l => register('lieux', l.pos, l.name, '', {type:l.type, startOn:l.startOn}));

    // --- 3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£ (‡∏Å‡∏•‡∏∏‡πà‡∏°) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
    var resourcesData = {
        "‡∏£‡∏≤‡∏™‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà": {
            icon: "resource/framboise.png",
            positions: [
                [-680.8, 330.9], [-668.5, 352.1], [-667.9, 268.5], [-648.3, 288.6], [-613.5, 317.4], [-602.8, 274.5], [-617.6, 211.6], [-571.5, 254.4], [-538.9, 208.6], [-527.8, 251.6], [-535.8, 288.3], [-503.1, 242.9], [-495, 222.4], [-453.8, 222.4], [-438.6, 246], [-395, 247.4], [-387.1, 269.5]
            ]
        },
        "‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà": {
            icon: "resource/myrtille.png",
            positions: [
                [-642.9, 371.9], [-631.9, 368.4], [-628.5, 365.5], [-606.8, 350.3], [-602.5, 342.3], [-590.1, 334.1], [-575.6, 332.1], [-562.1, 330], [-544.9, 324.5], [-518.4, 320.3], [-515.9, 320.5], [-500.8, 321.1], [-479.3, 328.6], [-468.3, 320], [-437.3, 313.9], [-411.4, 311.4], [-400.3, 311.4], [-379.5, 304.1], [-327.4, 352], [-313.6, 339], [-328.6, 371.5], [-324.4, 389.3], [-297.9, 410.8], [-271.6, 395.4], [-319.9, 413.5], [-330.4, 421.6], [-333.4, 450], [-338.6, 468.6], [-297.4, 484.4], [-349, 489.4], [-356.5, 499.3], [-360.4, 526.4], [-355.5, 545.1], [-352.9, 565.9], [-316, 558.1], [-363.6, 578.4], [-365.3, 609], [-360.9, 628.1], [-343, 634], [-388, 655.4], [-400.9, 654.3], [-421.9, 656.4], [-444.1, 670.6], [-462.5, 654], [-476.8, 654.6], [-491.6, 656.3], [-506.4, 672.4], [-525.4, 688], [-542.6, 650], [-559.3, 644.9], [-575.6, 651], [-597.8, 643.8], [-604.8, 633.8], [-627.9, 619.4]
            ]
        },
        "‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•": {
            icon: "resource/pomme.png",
            positions: [
                [-356.3, 493], [-365.4, 560.1], [-362.4, 581], [-324.6, 570.1], [-296, 610.3], [-365.6, 619.5], [-362.8, 628.5], [-393.5, 654.8], [-420.6, 653.3], [-436.1, 665.4], [-444.4, 685.1], [-436.6, 697.5], [-458.4, 744.9], [-505, 677.3], [-494.5, 657], [-459.8, 653.6], [-530.1, 677.9], [-540.1, 648.6], [-592.8, 676.6], [-606.9, 634.1], [-629.3, 623]
            ]
        },
        "‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏ç‡πà": {
            icon: "resource/grand arbre.png",
            positions: [
                [-612, 424.5], [-641.8, 369], [-351, 329.5], [-414.3, 337.1], [-396.3, 608.9], [-376.3, 624], [-616, 593.6], [-672.3, 642]
            ]
        },
        "‡πÑ‡∏°‡πâ‡πÇ‡∏≠‡πä‡∏Ñ‡∏•‡∏∑‡πà‡∏ô": {
            icon: "resource/bois de chaine glissant.png",
            positions: [[-532, 787.3]]
        },
        "‡∏´‡∏¥‡∏ô": {
            icon: "resource/pierre.png",
            positions: [
                [-615.9, 316], [-641.5, 278.8], [-558.4, 257.4], [-535, 292], [-499.5, 241.1], [-466.8, 283.1], [-407.1, 244.1], [-284, 402.8], [-254.6, 367.9], [-309.4, 479.1], [-263, 466.6], [-289.1, 544.6], [-315.5, 567.9], [-298.6, 625.4], [-391.3, 726.9], [-443.6, 697], [-468.6, 733.8], [-519, 714.9], [-564.9, 732.8], [-605.1, 680.3], [-673.9, 684.1]
            ]
        },
        "‡∏ü‡∏•‡∏π‡∏≠‡∏≠‡πÑ‡∏£‡∏ï‡πå": {
            icon: "resource/fluorite.png",
            positions: [[-417.8, 313.8]]
        },
        "‡∏™‡πâ‡∏°": {
            icon: "resource/orange.png",
            positions: [
                [-650.1, 370.9], [-639.5, 372], [-607.3, 351.4], [-602.9, 343.5], [-588.6, 336.6], [-559.6, 329.5], [-542.1, 324.8], [-515, 319.5], [-470.5, 321], [-461.4, 271.5], [-410.8, 314], [-397.3, 310.1], [-310.9, 339.3], [-327.6, 373.9], [-324.9, 391.9], [-295.4, 411.1], [-330.4, 420.9], [-333.8, 452.9]
            ]
        }
    };

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏°‡∏≤‡∏£‡πå‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
    var activeResourceLayers = {}; 

    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
    const fishList = [
        {name:"‡∏õ‡∏•‡∏≤ Bleak", bg:"condition/ablette_lieu.png", cond:"condition/ablette_meteo.png", heure:"condition/ablette_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Acantharchus", bg:"condition/acantharchus_pomotis_lieu.png", cond:"condition/acantharchus_pomotis_meteo.png", heure:"condition/acantharchus_pomotis_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•‡∏¢‡∏∏‡πÇ‡∏£‡∏õ", bg:"condition/anguille_europeenne_lieu.png", cond:"condition/anguille_europeenne_meteo.png", heure:"condition/anguille_europeenne_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Aphyosemion", bg:"condition/aphyosemion_striatum_lieu.png", cond:"condition/aphyosemion_striatum_meteo.png", heure:"condition/aphyosemion_striatum_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏ö‡∏≤‡∏£‡πå‡πÄ‡∏ö‡∏•", bg:"condition/barbeau_lieu.png", cond:"condition/barbeau_meteo.png", heure:"condition/barbeau_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏ö‡∏≤‡∏£‡πå‡πÄ‡∏ö‡∏•‡∏™‡∏ï‡∏µ‡∏î", bg:"condition/barbillon_lieu.png", cond:"condition/barbillon_meteo.png", heure:"condition/barbillon_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÅ‡∏≠‡∏á‡πÄ‡∏Å‡∏•‡∏≠‡∏£‡πå", bg:"condition/baudroie_lieu.png", cond:"condition/baudroie_meteo.png", heure:"condition/baudroie_heure.png"},
        {name:"‡∏õ‡∏π‡πÄ‡∏™‡∏â‡∏ß‡∏ô", bg:"condition/bernard_lhermite_lieu.png", cond:"condition/bernard_lhermite_meteo.png", heure:"condition/bernard_lhermite_heure.png"},
     
        {name:"‡∏õ‡∏•‡∏≤‡πÄ‡∏ö‡∏•‡∏ô‡∏ô‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥", bg:"condition/blennie_de_riviere_lieu.png", cond:"condition/blennie_de_riviere_meteo.png", heure:"condition/blennie_de_riviere_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÇ‡∏ö‡∏ô‡∏¥‡πÇ‡∏ï", bg:"condition/bonite_lieu.png", cond:"condition/bonite_meteo.png", heure:"condition/bonite_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÑ‡∏û‡∏Ñ‡πå‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î", bg:"condition/brochet_tachete_lieu.png", cond:"condition/brochet_tachete_meteo.png", heure:"condition/brochet_tachete_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏Ñ‡∏≤‡∏£‡πå‡∏õ‡πÄ‡∏á‡∏¥‡∏ô", bg:"condition/carpe_argente_lieu.png", cond:"condition/carpe_argente_meteo.png", heure:"condition/carpe_argente_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏Ñ‡∏≤‡∏£‡πå‡∏õ‡∏¢‡∏∏‡πÇ‡∏£‡∏õ", bg:"condition/carpe_europeenne_lieu.png", cond:"condition/carpe_europeenne_meteo.png", heure:"condition/carpe_europeenne_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏Ñ‡∏≤‡∏£‡πå‡∏õ‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠", bg:"condition/carpe_papillon_lieu.png", cond:"condition/carpe_papillon_meteo.png", heure:"condition/carpe_papillon_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏Ñ‡∏≤‡∏£‡πå‡∏õ‡∏î‡∏≥", bg:"condition/carpe_noire_lieu.png", cond:"condition/carpe_noire_meteo.png", heure:"condition/carpe_noire_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏™‡∏Ñ‡∏±‡∏•‡∏û‡∏¥‡∏ô", bg:"condition/chabot_lieu.png", cond:"condition/chabot_meteo.png", heure:"condition/chabot_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏Ñ‡∏¥‡πÄ‡∏°‡∏£‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô", 
        bg:"condition/chimere_argentee_lieu.png", cond:"condition/chimere_argentee_meteo.png", heure:"condition/chimere_argentee_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á‡πÇ‡∏Ñ‡πÄ‡∏°‡∏ó", bg:"condition/comete_coussut_lieu.png", cond:"condition/comete_coussut_meteo.png", heure:"condition/comete_coussut_heure.png"},
        {name:"‡∏õ‡∏π‡∏•‡∏≥‡∏ò‡∏≤‡∏£", bg:"condition/crabe_de_ruisseau_lieu.png", cond:"condition/crabe_de_ruisseau_meteo.png", heure:"condition/crabe_de_ruisseau_heure.png"},
        {name:"‡∏Å‡∏∏‡πâ‡∏á‡∏ó‡∏∞‡πÄ‡∏•", bg:"condition/crevette_de_la_mer_lieu.png", cond:"condition/crevette_de_la_mer_meteo.png", heure:"condition/crevette_de_la_mer_heure.png"},
        {name:"‡∏Å‡∏∏‡πâ‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", bg:"condition/crevette_verte_lieu.png", cond:"condition/crevette_verte_meteo.png", heure:"condition/crevette_verte_heure.png"},
        {name:"‡πÄ‡∏Ñ‡∏£‡∏¢‡πå‡∏ü‡∏¥‡∏ä", bg:"condition/ecrevisse_noble_lieu.png", cond:"condition/ecrevisse_noble_meteo.png", heure:"condition/ecrevisse_noble_heure.png"},
        {name:"‡πÄ‡∏Ñ‡∏£‡∏¢‡πå‡∏ü‡∏¥‡∏ä‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô", bg:"condition/ecrevisse_noble_bleue_lieu.png", cond:"condition/ecrevisse_noble_bleue_meteo.png", heure:"condition/ecrevisse_noble_bleue_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÅ‡∏Æ‡∏î‡∏î‡πá‡∏≠‡∏Å", bg:"condition/eglefin_lieu.png", cond:"condition/eglefin_meteo.png", heure:"condition/eglefin_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏™‡∏°‡∏¥‡∏•‡∏ó‡πå", bg:"condition/eperlan_lieu.png", 
        cond:"condition/eperlan_meteo.png", heure:"condition/eperlan_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Fera", bg:"condition/fera_lieu.png", cond:"condition/fera_meteo.png", heure:"condition/fera_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÅ‡∏ö‡∏•‡πá‡∏Ñ‡πÄ‡∏ö‡∏™‡πÉ‡∏´‡∏ç‡πà", bg:"condition/grand_blackbasse_lieu.png", cond:"condition/grand_blackbasse_meteo.png", heure:"condition/grand_blackbasse_heure.png"},
        {name:"‡∏Å‡∏ö‡∏¢‡∏∏‡πÇ‡∏£‡∏õ", bg:"condition/grenouille_europeenne_lieu.png", cond:"condition/grenouille_europeenne_meteo.png", heure:"condition/grenouille_europeenne_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏ö‡∏π‡πà", bg:"condition/gobie_lieu.png", cond:"condition/gobie_meteo.png", heure:"condition/gobie_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Gurnard", bg:"condition/grondin_perlon_lieu.png", cond:"condition/grondin_perlon_meteo.png", heure:"condition/grondin_perlon_heure.png"},
        {name:"‡∏°‡πâ‡∏≤‡∏ô‡πâ‡∏≥", bg:"condition/hippocampe_lieu.png", cond:"condition/hippocampe_meteo.png", heure:"condition/hippocampe_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Huchen", bg:"condition/huchon_lieu.png", cond:"condition/huchon_meteo.png", heure:"condition/huchon_heure.png"},
        {name:"‡∏Å‡∏∏‡πâ‡∏á‡∏°‡∏±‡∏á‡∏Å‡∏£‡∏¢‡∏∏‡πÇ‡∏£‡∏õ", bg:"condition/langouste_europeenne_lieu.png", cond:"condition/langouste_europeenne_meteo.png", heure:"condition/langouste_europeenne_heure.png"},
     
        {name:"‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏π‡∏≠‡∏≤‡∏£‡∏µ‡∏¢‡πå", bg:"condition/loche_des_fleurs_lieu.png", cond:"condition/loche_des_fleurs_meteo.png", heure:"condition/loche_des_fleurs_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏π‡∏´‡∏¥‡∏ô", bg:"condition/loche_des_rochers_lieu.png", cond:"condition/loche_des_rochers_meteo.png", heure:"condition/loche_des_rochers_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Monkfish", bg:"condition/lotte_lieu.png", cond:"condition/lotte_meteo.png", heure:"condition/lotte_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÅ‡∏°‡∏Ñ‡πÄ‡∏Ñ‡∏≠‡πÄ‡∏£‡∏•‡πÅ‡∏≠‡∏ï‡πÅ‡∏•‡∏ô‡∏ï‡∏¥‡∏Å", bg:"condition/maquereau_atlantique_lieu.png", cond:"condition/maquereau_atlantique_meteo.png", heure:"condition/maquereau_atlantique_heure.png"},
        {name:"‡∏´‡∏≠‡∏¢‡πÅ‡∏°‡∏•‡∏á‡∏†‡∏π‡πà", bg:"condition/moule_lieu.png", cond:"condition/moule_meteo.png", heure:"condition/moule_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Arctic Char", bg:"condition/omble_chevalier_lieu.png", cond:"condition/omble_chevalier_meteo.png", heure:"condition/omble_chevalier_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Drum", bg:"condition/ombrine_lieu.png", cond:"condition/ombrine_meteo.png", heure:"condition/ombrine_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Pagellus", bg:"condition/pagellus_bogaraveo_lieu.png", cond:"condition/pagellus_bogaraveo_meteo.png", heure:"condition/pagellus_bogaraveo_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏Å‡∏∞‡∏û‡∏á‡∏ó‡∏∞‡πÄ‡∏•", bg:"condition/perche_de_mer_lieu.png", cond:"condition/perche_de_mer_meteo.png", heure:"condition/perche_de_mer_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ä‡∏û‡∏•‡∏±‡∏°", bg:"condition/perche_de_prunier_lieu.png", cond:"condition/perche_de_prunier_meteo.png", heure:"condition/perche_de_prunier_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ä‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥", bg:"condition/perche_de_riviere_lieu.png", cond:"condition/perche_de_riviere_meteo.png", heure:"condition/perche_de_riviere_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏∂‡∏Å‡∏¢‡∏±‡∏Å‡∏©‡πå", bg:"condition/pieuvre_lieu.png", cond:"condition/pieuvre_meteo.png", heure:"condition/pieuvre_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏∂‡∏Å‡∏¢‡∏±‡∏Å‡∏©‡πå‡πÅ‡∏Ñ‡∏£‡∏∞", bg:"condition/pieuvre_naine_atlantique_lieu.png", cond:"condition/pieuvre_naine_atlantique_meteo.png", heure:"condition/pieuvre_naine_atlantique_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÑ‡∏ó‡πÄ‡∏Å‡∏≠‡∏£‡πå", bg:"condition/poissontigre_a_ventre_rouge_lieu.png", cond:"condition/poissontigre_a_ventre_rouge_meteo.png", heure:"condition/poissontigre_a_ventre_rouge_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Plaice ‡∏¢‡∏∏‡πÇ‡∏£‡∏õ", bg:"condition/plie_europeenne_lieu.png", cond:"condition/plie_europeenne_meteo.png", heure:"condition/plie_europeenne_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô", bg:"condition/poissonclown_lieu.png", cond:"condition/poissonclown_meteo.png", heure:"condition/poissonclown_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏´‡∏ô‡∏≤‡∏°", bg:"condition/poisson_epineux_lieu.png", 
        cond:"condition/poisson_epineux_meteo.png", heure:"condition/poisson_epineux_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏õ‡∏±‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥", bg:"condition/poissonglobe_de_riviere_lieu.png", cond:"condition/poissonglobe_de_riviere_meteo.png", heure:"condition/poissonglobe_de_riviere_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á", bg:"condition/poisson_rouge_lieu.png", cond:"condition/poisson_rouge_meteo.png", heure:"condition/poisson_rouge_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏î‡∏≤‡∏ö‡πÄ‡∏á‡∏¥‡∏ô", bg:"condition/poisson_ruban_lieu.png", cond:"condition/poisson_ruban_meteo.png", heure:"condition/poisson_ruban_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏ï‡∏≤‡πÅ‡∏î‡∏á", bg:"condition/poisson_a_yeux_rouges_lieu.png", cond:"condition/poisson_a_yeux_rouges_meteo.png", heure:"condition/poisson_a_yeux_rouges_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏≠‡∏≠‡∏£‡πå", bg:"condition/regalec_lieu.png", cond:"condition/regalec_meteo.png", heure:"condition/regalec_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Red Mullet", bg:"condition/rouget_barbet_lieu.png", cond:"condition/rouget_barbet_meteo.png", heure:"condition/rouget_barbet_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏â‡∏•‡∏≤‡∏°‡∏Å‡∏ö", bg:"condition/roussette_lieu.png", cond:"condition/roussette_meteo.png", heure:"condition/roussette_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÅ‡∏ã‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≤‡∏ß", bg:"condition/sandre_blanc_lieu.png", 
        cond:"condition/sandre_blanc_meteo.png", heure:"condition/sandre_blanc_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÅ‡∏ã‡∏•‡∏°‡∏≠‡∏ô‡πÅ‡∏≠‡∏ï‡πÅ‡∏•‡∏ô‡∏ï‡∏¥‡∏Å", bg:"condition/saumon_atlantique_lieu.png", cond:"condition/saumon_atlantique_meteo.png", heure:"condition/saumon_atlantique_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÅ‡∏ã‡∏•‡∏°‡∏≠‡∏ô‡∏ä‡∏∏‡∏°", bg:"condition/saumon_keta_lieu.png", cond:"condition/saumon_keta_meteo.png", heure:"condition/saumon_keta_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Saurel", bg:"condition/saurel_lieu.png", cond:"condition/saurel_meteo.png", heure:"condition/saurel_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏ã‡∏≤‡∏£‡πå‡∏î‡∏µ‡∏ô", bg:"condition/sardine_lieu.png", cond:"condition/sardine_meteo.png", heure:"condition/sardine_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏∂‡∏Å‡∏Å‡∏£‡∏∞‡∏î‡∏≠‡∏á", bg:"condition/seiche_europeenne_lieu.png", cond:"condition/seiche_europeenne_meteo.png", heure:"condition/seiche_europeenne_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å‡∏¢‡∏∏‡πÇ‡∏£‡∏õ", bg:"condition/silure_europeen_lieu.png", cond:"condition/silure_europeen_meteo.png", heure:"condition/silure_europeen_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Tench ‡∏ó‡∏≠‡∏á", bg:"condition/tanche_doree_lieu.png", cond:"condition/tanche_doree_meteo.png", heure:"condition/tanche_doree_heure.png"},
        {name:"‡∏•‡∏π‡∏Å‡∏≠‡πä‡∏≠‡∏î", bg:"condition/tetard_lieu.png", cond:"condition/tetard_meteo.png", heure:"condition/tetard_heure.png"},
     
        {name:"‡∏õ‡∏•‡∏≤‡∏ó‡∏¥‡∏•‡∏≤‡πÄ‡∏û‡∏µ‡∏¢", bg:"condition/tilapia_lieu.png", cond:"condition/tilapia_meteo.png", heure:"condition/tilapia_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡πÄ‡∏ó‡∏≠‡∏£‡πå‡∏ö‡∏≠‡∏ï", bg:"condition/turbot_lieu.png", cond:"condition/turbot_meteo.png", heure:"condition/turbot_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤‡∏ã‡∏¥‡∏ß", bg:"condition/vairon_lieu.png", cond:"condition/vairon_meteo.png", heure:"condition/vairon_heure.png"},
        {name:"‡∏õ‡∏•‡∏≤ Zingel", bg:"condition/zingel_streber_lieu.png", cond:"condition/zingel_streber_meteo.png", heure:"condition/zingel_streber_heure.png"}
    ];
    const bugList = [
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏á‡∏ï‡∏¥‡πà‡∏á", bg:"condition/actias_neidhoederi_lieu.png", cond:"condition/actias_neidhoederi_meteo.png", heure:"condition/actias_neidhoederi_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏≠‡∏≠‡πÇ‡∏£‡∏£‡∏≤", bg:"condition/pieride_du_cresson_lieu.png", cond:"condition/pieride_du_cresson_meteo.png", heure:"condition/pieride_du_cresson_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ Citron", bg:"condition/citron_aspasia_lieu.png", cond:"condition/citron_aspasia_meteo.png", heure:"condition/citron_aspasia_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏´‡∏ô‡∏≠‡∏ô‡∏Å‡∏∞‡∏´‡∏•‡πà‡∏≥", bg:"condition/pieride_du_cresson_lieu.png", cond:"condition/pieride_du_cresson_meteo.png", heure:"condition/pieride_du_cresson_heure.png"},
        {name:"Actias neidhoederi", bg:"condition/actias_neidhoederi_lieu.png", cond:"condition/actias_neidhoederi_meteo.png", heure:"condition/actias_neidhoederi_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ Holly Blue", bg:"condition/azure_de_porcelaine_lieu.png", cond:"condition/azure_de_porcelaine_meteo.png", heure:"condition/azure_de_porcelaine_heure.png"},
        {name:"‡∏ú‡∏∂‡πâ‡∏á‡∏ö‡∏±‡∏°‡πÄ‡∏ö‡∏¥‡∏•‡∏ö‡∏µ", bg:"condition/bourdon_lieu.png", cond:"condition/bourdon_meteo.png", heure:"condition/bourdon_heure.png"},
        {name:"‡∏î‡πâ‡∏ß‡∏á‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô", bg:"condition/cetoine_etoilee_bleue_lieu.png", cond:"condition/cetoine_etoilee_bleue_meteo.png", heure:"condition/cetoine_etoilee_bleue_heure.png"},
        {name:"‡∏î‡πâ‡∏ß‡∏á‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", bg:"condition/cicindele_verte_lieu.png", cond:"condition/cicindele_verte_meteo.png", heure:"condition/cicindele_verte_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ Aspasia", bg:"condition/citron_aspasia_lieu.png", cond:"condition/citron_aspasia_meteo.png", heure:"condition/citron_aspasia_heure.png"},
        {name:"‡πÄ‡∏ï‡πà‡∏≤‡∏ó‡∏≠‡∏á 7 ‡∏à‡∏∏‡∏î", bg:"condition/coccinelle_a_sept_points_lieu.png", cond:"condition/coccinelle_a_sept_points_meteo.png", heure:"condition/coccinelle_a_sept_points_heure.png"},
        {name:"‡πÄ‡∏ï‡πà‡∏≤‡∏ó‡∏≠‡∏á‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢", bg:"condition/coccinelle_asiatique_lieu.png", 
        cond:"condition/coccinelle_asiatique_meteo.png", heure:"condition/coccinelle_asiatique_heure.png"},
        {name:"‡∏î‡πâ‡∏ß‡∏á‡∏´‡∏ô‡πà‡∏≠‡πÑ‡∏°‡πâ‡∏ù‡∏£‡∏±‡πà‡∏á", bg:"condition/criocere_de_lasperge_lieu.png", cond:"condition/criocere_de_lasperge_meteo.png", heure:"condition/criocere_de_lasperge_heure.png"},
        {name:"‡∏à‡∏¥‡πâ‡∏á‡∏´‡∏£‡∏µ‡∏î‡∏Ç‡∏≤‡∏¢‡∏±‡∏Å‡∏©‡πå", bg:"condition/criquet_aux_pattes_massives_lieu.png", cond:"condition/criquet_aux_pattes_massives_meteo.png", heure:"condition/criquet_aux_pattes_massives_heure.png"},
        {name:"‡πÅ‡∏°‡∏•‡∏á‡∏õ‡∏≠‡πÄ‡∏Ç‡πá‡∏°‡πÉ‡∏´‡∏ç‡πà", bg:"condition/grand_agrion_lieu.png", cond:"condition/grand_agrion_meteo.png", heure:"condition/grand_agrion_heure.png"},
        {name:"‡πÅ‡∏°‡∏•‡∏á‡∏õ‡∏≠‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î", bg:"condition/libellule_tachetee_lieu.png", cond:"condition/libellule_tachetee_meteo.png", heure:"condition/libellule_tachetee_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ß‡∏á‡πÅ‡∏´‡∏ß‡∏ô‡πÅ‡∏î‡∏á", bg:"condition/papillon_a_anneaux_rouges_lieu.png", cond:"condition/papillon_a_anneaux_rouges_meteo.png", heure:"condition/papillon_a_anneaux_rouges_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Ñ‡∏≠‡πÅ‡∏î‡∏á", bg:"condition/papillon_a_col_rouge_lieu.png", cond:"condition/papillon_a_col_rouge_meteo.png", heure:"condition/papillon_a_col_rouge_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏ß", bg:"condition/papillon_blanc_lieu.png", cond:"condition/papillon_blanc_meteo.png", heure:"condition/papillon_blanc_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ó‡∏≠‡∏á", bg:"condition/papillon_dore_lieu.png", cond:"condition/papillon_dore_meteo.png", heure:"condition/papillon_dore_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ Parnassian", bg:"condition/parnassien_lieu.png", cond:"condition/parnassien_meteo.png", heure:"condition/parnassien_heure.png"},
        {name:"‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏û‡∏á‡∏û‡∏ß‡∏¢", bg:"condition/pieride_du_cresson_lieu.png", cond:"condition/pieride_du_cresson_meteo.png", heure:"condition/pieride_du_cresson_heure.png"},
        {name:"‡∏°‡∏ß‡∏ô‡∏û‡∏¥‡∏Ñ‡∏≤‡∏™‡πÇ‡∏ã‡πà", bg:"condition/punaise_picasso_lieu.png", cond:"condition/punaise_picasso_meteo.png", heure:"condition/punaise_picasso_heure.png"},
        {name:"‡∏î‡πâ‡∏ß‡∏á‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏¥‡∏ô‡∏±‡∏•", bg:"condition/pyrochroa_lieu.png", cond:"condition/pyrochroa_meteo.png", heure:"condition/pyrochroa_heure.png"},
        {name:"‡∏°‡∏ß‡∏ô‡πÅ‡∏î‡∏á", bg:"condition/pyrrhocoris_apterus_lieu.png", cond:"condition/pyrrhocoris_apterus_meteo.png", heure:"condition/pyrrhocoris_apterus_heure.png"},
        {name:"‡∏ï‡∏±‡πä‡∏Å‡πÅ‡∏ï‡∏ô‡πÇ‡∏≠‡πÄ‡∏≠‡∏ã‡∏¥‡∏™", bg:"condition/sauterelle_de_loasis_lieu.png", cond:"condition/sauterelle_de_loasis_meteo.png", heure:"condition/sauterelle_de_loasis_heure.png"},
        {name:"‡∏î‡πâ‡∏ß‡∏á‡∏¢‡∏π‡∏ô‡∏¥‡∏Ñ‡∏≠‡∏£‡πå‡∏ô", bg:"condition/scarabee_unicorne_lieu.png", cond:"condition/scarabee_unicorne_meteo.png", heure:"condition/scarabee_unicorne_heure.png"}
    ];
    const birdList = [
        {name:"‡∏ô‡∏Å‡πÅ‡∏Å‡πâ‡∏ß‡∏°‡∏≤‡∏Ñ‡∏≠‡∏ß‡πå‡∏™‡∏µ‡∏ü‡πâ‡∏≤-‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", bg:"condition/ara_bleu_et_jaune_lieu.png", cond:"condition/ara_bleu_et_jaune_meteo.png", heure:"condition/ara_bleu_et_jaune_heure.png"},
        {name:"‡∏ô‡∏Å‡πÅ‡∏Å‡πâ‡∏ß‡∏°‡∏≤‡∏Ñ‡∏≠‡∏ß‡πå‡∏™‡∏µ‡πÅ‡∏î‡∏á-‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", bg:"condition/ara_rouge_et_vert_lieu.png", cond:"condition/ara_rouge_et_vert_meteo.png", heure:"condition/ara_rouge_et_vert_heure.png"},
        {name:"‡∏ô‡∏Å‡πÅ‡∏Å‡πâ‡∏ß‡∏°‡∏≤‡∏Ñ‡∏≠‡∏ß‡πå‡∏™‡∏µ‡∏Ñ‡∏£‡∏≤‡∏°", bg:"condition/ara_indigo_lieu.png", cond:"condition/ara_indigo_meteo.png", heure:"condition/ara_indigo_heure.png"},
        {name:"‡∏ô‡∏Å‡∏≠‡∏∏‡πâ‡∏°‡∏ö‡∏≤‡∏ï‡∏£", bg:"condition/bergeronnette_grise_lieu.png", cond:"condition/bergeronnette_grise_meteo.png", heure:"condition/bergeronnette_grise_heure.png"},
        {name:"‡∏ô‡∏Å Bullfinch", bg:"condition/bouvreuil_lieu.png", cond:"condition/bouvreuil_meteo.png", heure:"condition/bouvreuil_heure.png"},
        {name:"‡∏ô‡∏Å Bullfinch ‡∏ó‡πâ‡∏≠‡∏á‡πÅ‡∏î‡∏á", bg:"condition/bouvreuil_a_ventre_rouge_lieu.png", cond:"condition/bouvreuil_a_ventre_rouge_meteo.png", heure:"condition/bouvreuil_a_ventre_rouge_heure.png"},
        {name:"‡∏ô‡∏Å Tanager ‡πÄ‡∏à‡πá‡∏î‡∏™‡∏µ", bg:"condition/calliste_septicolore_lieu.png", cond:"condition/calliste_septicolore_meteo.png", heure:"condition/calliste_septicolore_heure.png"},
        {name:"‡πÄ‡∏õ‡πá‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡∏≤‡∏ß", bg:"condition/canard_a_tete_blanche_lieu.png", cond:"condition/canard_a_tete_blanche_meteo.png", heure:"condition/canard_a_tete_blanche_heure.png"},
        {name:"‡πÄ‡∏õ‡πá‡∏î‡πÅ‡∏°‡∏•‡∏•‡∏≤‡∏£‡πå‡∏î", bg:"condition/canard_colvert_lieu.png", cond:"condition/canard_colvert_meteo.png", heure:"condition/canard_colvert_heure.png"},
        {name:"‡πÄ‡∏õ‡πá‡∏î‡∏ß‡∏¥‡πÄ‡∏à‡∏µ‡∏¢‡∏ô", bg:"condition/canard_siffleur_lieu.png", cond:"condition/canard_siffleur_meteo.png", heure:"condition/canard_siffleur_heure.png"},
        {name:"‡∏ô‡∏Å‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏¥‡∏ô‡∏±‡∏•‡∏°‡∏á‡∏Å‡∏∏‡∏é‡πÄ‡∏ó‡∏≤", bg:"condition/cardinal_a_couronne_grisecolombar_a_cou_rose_lieu.png", cond:"condition/cardinal_a_couronne_grisecolombar_a_cou_rose_meteo.png", heure:"condition/cardinal_a_couronne_grisecolombar_a_cou_rose_heure.png"},
        {name:"‡∏ô‡∏Å‡πÄ‡∏Ç‡∏≤‡∏ú‡∏•‡πÑ‡∏°‡πâ Jambu", bg:"condition/colombe_jambu_lieu.png", cond:"condition/colombe_jambu_meteo.png", heure:"condition/colombe_jambu_heure.png"},
        {name:"‡∏ô‡∏Å‡∏ü‡∏¥‡∏ô‡∏ã‡πå‡∏°‡πâ‡∏≤‡∏•‡∏≤‡∏¢", bg:"condition/diamant_mandarin_lieu.png", cond:"condition/diamant_mandarin_meteo.png", heure:"condition/diamant_mandarin_heure.png"},
        {name:"‡πÄ‡∏õ‡πá‡∏î King Eider", bg:"condition/eider_royal_lieu.png", cond:"condition/eider_royal_meteo.png", heure:"condition/eider_royal_heure.png"},
        {name:"‡πÑ‡∏Å‡πà‡∏ü‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á‡∏Ç‡∏≤‡∏ß", bg:"condition/faisan_a_ventre_blanc_lieu.png", cond:"condition/faisan_a_ventre_blanc_meteo.png", heure:"condition/faisan_a_ventre_blanc_heure.png"},
        {name:"‡πÄ‡∏´‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡∏ï‡∏µ‡∏ô‡πÅ‡∏î‡∏á", bg:"condition/faucon_a_pattes_rouges_lieu.png", cond:"condition/faucon_a_pattes_rouges_meteo.png", heure:"condition/faucon_a_pattes_rouges_heure.png"},
        {name:"‡πÄ‡∏´‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏û‡πÄ‡∏£‡∏Å‡∏£‡∏¥‡∏ô", bg:"condition/faucon_pelerin_lieu.png", cond:"condition/faucon_pelerin_meteo.png", heure:"condition/faucon_pelerin_heure.png"},
        {name:"‡πÄ‡∏´‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡πÅ‡∏î‡∏á", bg:"condition/faucon_rouge_lieu.png", cond:"condition/faucon_rouge_meteo.png", heure:"condition/faucon_rouge_heure.png"},
        {name:"‡∏ü‡∏•‡∏≤‡∏°‡∏¥‡∏á‡πÇ‡∏Å‡πâ", bg:"condition/flamant_rose_americain_lieu.png", cond:"condition/flamant_rose_americain_meteo.png", heure:"condition/flamant_rose_americain_heure.png"},
        {name:"‡∏ô‡∏Å Chaffinch", bg:"condition/fringilla_coelebs_lieu.png", cond:"condition/fringilla_coelebs_meteo.png", heure:"condition/fringilla_coelebs_heure.png"},
        {name:"‡∏ô‡∏Å‡∏à‡∏±‡∏ö‡πÅ‡∏°‡∏•‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", bg:"condition/gobemouche_vertdegris_lieu.png", cond:"condition/gobemouche_vertdegris_meteo.png", heure:"condition/gobemouche_vertdegris_heure.png"},
        {name:"‡∏ô‡∏Å‡∏ô‡∏≤‡∏á‡∏ô‡∏ß‡∏•", bg:"condition/goeland_lieu.png", cond:"condition/goeland_meteo.png", heure:"condition/goeland_heure.png"},
        {name:"‡∏ô‡∏Å‡∏Ç‡∏°‡∏¥‡πâ‡∏ô", bg:"condition/golden_oriole_lieu.png", cond:"condition/golden_oriole_meteo.png", heure:"condition/golden_oriole_heure.png"},
        {name:"‡∏ô‡∏Å‡∏Æ‡∏π‡∏Å‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ", bg:"condition/grand_duc_deurope_lieu.png", cond:"condition/grand_duc_deurope_meteo.png", heure:"condition/grand_duc_deurope_heure.png"},
  
        {name:"‡∏ü‡∏•‡∏≤‡∏°‡∏¥‡∏á‡πÇ‡∏Å‡πâ‡πÉ‡∏´‡∏ç‡πà", bg:"condition/grand_flamant_lieu.png", cond:"condition/grand_flamant_meteo.png", heure:"condition/grand_flamant_heure.png"},
        {name:"‡∏ô‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡∏ß‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏á", bg:"condition/grand_pic_lieu.png", cond:"condition/grand_pic_meteo.png", heure:"condition/grand_pic_heure.png"},
        {name:"‡∏ô‡∏Å Hawfinch", bg:"condition/grosbec_lieu.png", cond:"condition/grosbec_meteo.png", heure:"condition/grosbec_heure.png"},
        {name:"‡∏ô‡∏Å‡∏à‡∏≤‡∏ö‡∏Ñ‡∏≤", bg:"condition/guepier_deurope_lieu.png", cond:"condition/guepier_deurope_meteo.png", heure:"condition/guepier_deurope_heure.png"},
        {name:"‡πÄ‡∏õ‡πá‡∏î Smew", bg:"condition/harle_piette_lieu.png", cond:"condition/harle_piette_meteo.png", heure:"condition/harle_piette_heure.png"},
        {name:"‡∏ô‡∏Å‡∏Æ‡∏π‡∏Å‡∏´‡∏π‡∏¢‡∏≤‡∏ß", bg:"condition/hibou_moyen_duc_lieu.png", cond:"condition/hibou_moyen_duc_meteo.png", heure:"condition/hibou_moyen_duc_heure.png"},
        {name:"‡∏ô‡∏Å Gardener ‡∏´‡∏±‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", bg:"condition/jardinier_a_tete_jaune_lieu.png", cond:"condition/jardinier_a_tete_jaune_meteo.png", heure:"condition/jardinier_a_tete_jaune_heure.png"},
        {name:"‡∏ô‡∏Å Linnet ‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß", bg:"condition/linotte_a_dos_blanc_lieu.png", cond:"condition/linotte_a_dos_blanc_meteo.png", heure:"condition/linotte_a_dos_blanc_heure.png"},
    
        {name:"‡∏ô‡∏Å Bluebird", bg:"condition/merle_bleu_de_lest_lieu.png", cond:"condition/merle_bleu_de_lest_meteo.png", heure:"condition/merle_bleu_de_lest_heure.png"},
        {name:"‡∏ô‡∏Å Tit ‡∏Ñ‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô", bg:"condition/mesange_a_menton_argent_lieu.png", cond:"condition/mesange_a_menton_argent_meteo.png", heure:"condition/mesange_a_menton_argent_heure.png"},
        {name:"‡∏ô‡∏Å Tit ‡∏™‡∏µ‡∏ü‡πâ‡∏≤", bg:"condition/mesange_bleue_lieu.png", cond:"condition/mesange_bleue_meteo.png", heure:"condition/mesange_bleue_heure.png"},
        {name:"‡∏ô‡∏Å‡∏à‡∏±‡∏ö‡πÅ‡∏°‡∏•‡∏á‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", bg:"condition/moucherolle_a_ventre_jaune_lieu.png", cond:"condition/moucherolle_a_ventre_jaune_meteo.png", heure:"condition/moucherolle_a_ventre_jaune_heure.png"},
        {name:"‡∏ô‡∏Å‡∏ô‡∏≤‡∏á‡∏ô‡∏ß‡∏•", bg:"condition/mouette_lieu.png", cond:"condition/mouette_meteo.png", heure:"condition/mouette_heure.png"},
        {name:"‡∏ô‡∏Å Reedling ‡∏´‡∏ô‡∏ß‡∏î", bg:"condition/panure_a_moustache_lieu.png", cond:"condition/panure_a_moustache_meteo.png", heure:"condition/panure_a_moustache_heure.png"},
        {name:"‡∏ô‡∏Å‡∏¢‡∏π‡∏á‡∏Ç‡∏≤‡∏ß", bg:"condition/paon_blanc_lieu.png", cond:"condition/paon_blanc_meteo.png", heure:"condition/paon_blanc_heure.png"},
        {name:"‡∏ô‡∏Å‡∏¢‡∏π‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô", bg:"condition/paon_bleu_lieu.png", cond:"condition/paon_bleu_meteo.png", heure:"condition/paon_bleu_heure.png"},
   
        {name:"‡∏ô‡∏Å‡∏¢‡∏π‡∏á‡∏î‡∏≥", bg:"condition/paon_noir_lieu.png", cond:"condition/paon_noir_meteo.png", heure:"condition/paon_noir_heure.png"},
        {name:"‡∏ô‡∏Å‡∏¢‡∏π‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", bg:"condition/paon_vert_lieu.png", cond:"condition/paon_vert_meteo.png", heure:"condition/paon_vert_heure.png"},
        {name:"‡∏ü‡∏•‡∏≤‡∏°‡∏¥‡∏á‡πÇ‡∏Å‡πâ‡πÄ‡∏•‡πá‡∏Å", bg:"condition/petit_flamant_lieu.png", cond:"condition/petit_flamant_meteo.png", heure:"condition/petit_flamant_heure.png"},
        {name:"‡∏ô‡∏Å Shrike ‡∏´‡∏±‡∏ß‡πÅ‡∏î‡∏á", bg:"condition/piegrieche_a_tete_rousse_lieu.png", cond:"condition/piegrieche_a_tete_rousse_meteo.png", heure:"condition/piegrieche_a_tete_rousse_heure.png"},
        {name:"‡∏ô‡∏Å‡πÄ‡∏Ç‡∏≤‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏ó‡∏≠‡∏á", bg:"condition/pigeon_aux_fruits_dor_lieu.png", cond:"condition/pigeon_aux_fruits_dor_meteo.png", heure:"condition/pigeon_aux_fruits_dor_heure.png"},
        {name:"‡∏ô‡∏Å‡∏û‡∏¥‡∏£‡∏≤‡∏ö‡∏ï‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", bg:"condition/pigeon_aux_yeux_jaunes_lieu.png", cond:"condition/pigeon_aux_yeux_jaunes_meteo.png", heure:"condition/pigeon_aux_yeux_jaunes_heure.png"},
        {name:"‡∏ô‡∏Å‡∏û‡∏¥‡∏£‡∏≤‡∏ö Stock", bg:"condition/pigeon_colombin_lieu.png", cond:"condition/pigeon_colombin_meteo.png", heure:"condition/pigeon_colombin_heure.png"},
        {name:"‡∏ô‡∏Å‡∏û‡∏¥‡∏£‡∏≤‡∏ö Wonga", bg:"condition/pigeon_de_wonga_lieu.png", cond:"condition/pigeon_de_wonga_meteo.png", heure:"condition/pigeon_de_wonga_heure.png"},
   
        {name:"‡∏ô‡∏Å‡∏û‡∏¥‡∏£‡∏≤‡∏ö‡∏ä‡∏°‡∏û‡∏π", bg:"condition/pigeon_rose_lieu.png", cond:"condition/pigeon_rose_meteo.png", heure:"condition/pigeon_rose_heure.png"},
        {name:"‡∏ô‡∏Å‡∏ü‡∏¥‡∏ô‡∏ã‡πå", bg:"condition/pinson_lieu.png", cond:"condition/pinson_meteo.png", heure:"condition/pinson_heure.png"},
        {name:"‡∏ô‡∏Å‡πÇ‡∏£‡∏ö‡∏¥‡∏ô", bg:"condition/rougegorge_lieu.png", cond:"condition/rougegorge_meteo.png", heure:"condition/rougegorge_heure.png"},
        {name:"‡∏ô‡∏Å Nuthatch", bg:"condition/sittelle_lieu.png", cond:"condition/sittelle_meteo.png", heure:"condition/sittelle_heure.png"},
        {name:"‡∏ô‡∏Å‡∏ô‡∏≤‡∏á‡∏ô‡∏ß‡∏•‡πÅ‡∏Å‡∏•‡∏ö", bg:"condition/sterne_lieu.png", cond:"condition/sterne_meteo.png", heure:"condition/sterne_heure.png"},
        {name:"‡∏ô‡∏Å‡∏ô‡∏≤‡∏á‡∏ô‡∏ß‡∏•‡πÅ‡∏Å‡∏•‡∏ö‡∏Ç‡∏≤‡∏ß", bg:"condition/sterne_blanche_lieu.png", cond:"condition/sterne_blanche_meteo.png", heure:"condition/sterne_blanche_heure.png"},
        {name:"‡πÄ‡∏õ‡πá‡∏î Ruddy Shelduck", bg:"condition/tadorne_casarca_lieu.png", cond:"condition/tadorne_casarca_meteo.png", heure:"condition/tadorne_casarca_heure.png"},
        {name:"‡∏ô‡∏Å‡πÄ‡∏Ç‡∏≤‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡∏≤", bg:"condition/tourterelle_a_tete_grise_lieu.png", cond:"condition/tourterelle_a_tete_grise_meteo.png", heure:"condition/tourterelle_a_tete_grise_heure.png"},
        
        {name:"‡∏ô‡∏Å‡πÄ‡∏Ç‡∏≤‡πÅ‡∏Ç‡∏Å", bg:"condition/tourterelle_grise_lieu.png", cond:"condition/tourterelle_grise_meteo.png", heure:"condition/tourterelle_grise_heure.png"},
        {name:"‡∏ô‡∏Å‡πÄ‡∏Ç‡∏≤‡πÉ‡∏´‡∏ç‡πà", bg:"condition/tourterelle_tigrine_lieu.png", cond:"condition/tourterelle_tigrine_meteo.png", heure:"condition/tourterelle_tigrine_heure.png"},
        {name:"‡∏ô‡∏Å Wren", bg:"condition/troglodyte_lieu.png", cond:"condition/troglodyte_meteo.png", heure:"condition/troglodyte_heure.png"}
    ];
    var menuCtrl = L.control({position: 'topleft'});
    menuCtrl.onAdd = function() {
        var div = L.DomUtil.create('div', 'leaflet-control-layers');
        div.id = "main-menu";
        div.innerHTML = `<div id="c-pnj"><div class="accordion-title title-pnj">NPC</div><div class="accordion-content"></div></div>
                         <div id="c-animal"><div class="accordion-title title-animal">‡∏™‡∏±‡∏ï‡∏ß‡πå</div><div class="accordion-content"></div></div>
                         <div id="c-bus"><div class="accordion-title title-bus">‡∏£‡∏ñ‡∏ö‡∏±‡∏™</div><div class="accordion-content"></div></div>
                         <div id="c-shop"><div class="accordion-title title-shop">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</div><div class="accordion-content"></div></div>
    
                         <div id="c-lieux"><div class="accordion-title title-lieux">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</div><div class="accordion-content"></div></div>
                         <div id="c-fish"><div class="accordion-title title-poisson">‡∏õ‡∏•‡∏≤</div><div class="accordion-content"></div></div>
                         <div id="c-bug"><div class="accordion-title title-insecte">‡πÅ‡∏°‡∏•‡∏á</div><div class="accordion-content"></div></div>
                 
                         <div id="c-bird"><div class="accordion-title title-bird">‡∏ô‡∏Å</div><div class="accordion-content"></div></div>
                         
                         <div id="c-resource"><div class="accordion-title title-resource">‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£</div><div class="accordion-content"></div></div>`;
        return div;
    };
    menuCtrl.addTo(map);
    function initMenu() {
        // --- 1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (NPC, ‡∏™‡∏±‡∏ï‡∏ß‡πå, ‡∏£‡∏ñ‡∏ö‡∏±‡∏™, ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà) ---
        ['pnj','animal','bus','shop','lieux'].forEach(cat => {
            var box = document.getElementById('c-'+cat), content = box.querySelector('.accordion-content');
            box.querySelector('.accordion-title').onclick = () => {
                const isOpening = !content.classList.contains('active');
              
                document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('active'));
                if(isOpening) { content.classList.add('active'); if(currentSingleMarker) { if(currentSingleMarker.moveTimer) clearTimeout(currentSingleMarker.moveTimer); map.removeLayer(currentSingleMarker.marker); currentSingleMarker = null; } }
            };
            dataStorage[cat].forEach(item => {
                var el = document.createElement('div'); el.className = 'menu-item'; el.innerHTML = item.name;
                el.onclick 
                = () => {
                    if (cat === 'bus' ||
                    cat === 'lieux' || (cat === 'pnj' && item.name !== "‡∏≠‡∏±‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ï ‡∏à‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå")) { map.flyTo(item.pos, 3, { animate: true, duration: 1.5 });
                    if(cat === 'pnj') item.marker.openPopup(); }
                    else if (cat === 'pnj' && item.name === "‡∏≠‡∏±‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ï ‡∏à‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå") { map.flyTo(item.marker.getLatLng(), 3, { animate: true });
                    item.marker.openPopup(); if(!item.marker.moveTimer) startAlbertPatrol(item.marker, 0); }
                    else {
                        if(currentSingleMarker) { if(currentSingleMarker.moveTimer) clearTimeout(currentSingleMarker.moveTimer);
                        map.removeLayer(currentSingleMarker.marker); }
                        let albert = dataStorage.pnj.find(i => i.name === "‡∏≠‡∏±‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ï ‡∏à‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå");
                        if(albert && albert.marker.moveTimer) { clearTimeout(albert.marker.moveTimer); albert.marker.moveTimer = null; if(albert.marker._icon) albert.marker._icon.classList.remove('albert-walk');
                        }
                        currentSingleMarker = item;
                        item.marker.setLatLng(item.pos).addTo(map); map.flyTo(item.pos, 3, { animate: true });
                        if(item.marker._icon) { item.marker._icon.classList.remove('smooth-move'); item.marker._icon.classList.remove('albert-walk');
                        }
                        if(cat === 'animal') setTimeout(() => triggerMovement(item), 500);
                        }
                    if(window.innerWidth <= 768) toggleMobileMenu();
                };
                content.appendChild(el);
            });
        });

        // --- 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô (‡∏õ‡∏•‡∏≤, ‡πÅ‡∏°‡∏•‡∏á, ‡∏ô‡∏Å) ---
        let savedCollection = JSON.parse(localStorage.getItem('maptopia_collection')) ||
        {};

        ['fish', 'bug', 'bird'].forEach(type => {
            let box = document.getElementById('c-'+type);
            if (!box) return; 

            let content = box.querySelector('.accordion-content');
  
            let list;
            if (type === 'fish') list = fishList;
            else if (type === 'bug') list = bugList;
            else list = birdList;

            box.querySelector('.accordion-title').onclick = () => {
               
                const isOpening = !content.classList.contains('active');
                document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('active'));
                if (isOpening) {
                    content.classList.add('active');
                    if (currentSingleMarker) {
                  
                        if (currentSingleMarker.moveTimer) clearTimeout(currentSingleMarker.moveTimer);
                        map.removeLayer(currentSingleMarker.marker);
                        currentSingleMarker = null;
                    }
                }
            };
            list.forEach(item => {
                let el = document.createElement('div');
                el.className = 'menu-item';

                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡πá‡∏≠‡∏Å‡∏ã‡πå
                let chk = document.createElement('input');
                chk.type = 'checkbox';
  
                chk.className = 'collection-check';
                chk.checked = !!savedCollection[item.name];

                chk.onclick = (e) => {
                    e.stopPropagation();
                    savedCollection[item.name] = chk.checked;
    
                    localStorage.setItem('maptopia_collection', JSON.stringify(savedCollection));
                };

                let span = document.createElement('span');
                span.innerText = item.name;
                span.style.flexGrow = "1";

            
                el.appendChild(chk);
                el.appendChild(span);

                // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                el.onclick = (e) => {
                    if (e.target.type === 'checkbox') return;
                    openOverlay(item.name, item.bg, item.cond, item.heure);
                    if (window.innerWidth <= 768) toggleMobileMenu();
                };
                content.appendChild(el);
            });
        });

        // --- 3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£ ---
        var resContainer = document.querySelector(`#c-resource .accordion-content`);
        var resTitle = document.querySelector(`#c-resource .accordion-title`);
        
        if(resContainer && resTitle) {
            resTitle.onclick = () => {
                const isOpening = !resContainer.classList.contains('active');
                document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('active'));
                if (isOpening) {
                    resContainer.classList.add('active');
                    if (currentSingleMarker) {
                        if (currentSingleMarker.moveTimer) clearTimeout(currentSingleMarker.moveTimer);
                        map.removeLayer(currentSingleMarker.marker);
                        currentSingleMarker = null;
                    }
                }
            };

            Object.keys(resourcesData).forEach(resName => {
                var data = resourcesData[resName];
                var div = document.createElement('div');
                div.className = 'menu-item';
                div.innerText = resName + " (" + data.positions.length + ")";

                div.onclick = function() {
                    toggleResourceGroup(resName, data, this);
                };
                resContainer.appendChild(div);
            });
        }

        L.DomEvent.disableScrollPropagation(document.getElementById('main-menu'));
        L.DomEvent.disableClickPropagation(document.getElementById('main-menu'));
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£
    function toggleResourceGroup(name, data, btnElement) {
        if (activeResourceLayers[name]) {
            activeResourceLayers[name].forEach(m => map.removeLayer(m));
            delete activeResourceLayers[name];
            btnElement.classList.remove('active-resource');
        } 
        else {
            var markers = [];
            data.positions.forEach(pos => {
                var m = L.marker(pos, {
                    icon: L.icon({
                        iconUrl: data.icon, 
                        iconSize: [30, 30],
                        className: 'resource-icon'
                    })
                }).addTo(map).bindPopup(name);
                markers.push(m);
            });
            activeResourceLayers[name] = markers;
            btnElement.classList.add('active-resource');
            
            // ‡∏ã‡∏π‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏ü‡∏•‡∏π‡∏≠‡∏≠‡πÑ‡∏£‡∏ï‡πå" ‡πÅ‡∏•‡∏∞ "‡πÑ‡∏°‡πâ‡πÇ‡∏≠‡πä‡∏Ñ‡∏•‡∏∑‡πà‡∏ô"
            if (name === "‡∏ü‡∏•‡∏π‡∏≠‡∏≠‡πÑ‡∏£‡∏ï‡πå" || name === "‡πÑ‡∏°‡πâ‡πÇ‡∏≠‡πä‡∏Ñ‡∏•‡∏∑‡πà‡∏ô") {
                 if (data.positions.length > 0) {
                     map.flyTo(data.positions[0], 4, { duration: 1.5 }); 
                 }
            }
        }
        
        if(window.innerWidth <= 768) toggleMobileMenu();
    }

    function openOverlay(name, img_loc, img_weather, img_time) {
        document.getElementById('info-name').innerText = name;
        document.getElementById('info-loc').src = img_loc;
        document.getElementById('info-weather').src = img_weather;
        document.getElementById('info-time').src = img_time; 
        document.getElementById('overlay-info').style.display = 'flex';
    }
    userPings.forEach(p => createFinalMarker(p));
    updateUserLegend();
    setTimeout(initMenu, 300);
    let albert = dataStorage.pnj.find(i => i.name === "‡∏≠‡∏±‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ï ‡∏à‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå");
    if(albert) startAlbertPatrol(albert.marker, 0);

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏•‡∏Ñ‡πå
    initLikeSystem();
    // --- ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏Ñ‡∏ß‡∏¥‡∏ã (30 ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°) - ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ---
    const heartopiaQuestions = [
        { q: "‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏Å‡∏î‡πå‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô?", o: ["‡∏≠‡∏±‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ï ‡∏à‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå", "‡∏ö‡∏≤‡∏£‡πå‡∏ô‡∏≤‡∏ö‡∏µ", "‡πÄ‡∏≠‡∏£‡∏¥‡∏Ñ"], a: 0 },
        { q: "‡∏´‡∏≤‡∏õ‡∏•‡∏≤ Acantharchus ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏á‡∏ö", "‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏õ‡πà‡∏≤", "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏≠‡∏≠‡πÇ‡∏£‡∏£‡∏≤"], a: 0 },
        { q: "NPC ‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°?", o: ["‡∏ô‡∏±‡∏Å‡∏™‡∏∞‡∏™‡∏°", "‡∏ö‡πä‡∏≠‡∏ö", "‡∏°‡∏±‡∏™‡∏™‡∏¥‡πÇ‡∏°"], a: 0 },
        { q: "‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏£‡∏∏‡πâ‡∏á‡∏Å‡∏¥‡∏ô‡∏ô‡πâ‡∏≥?", o: ["‡∏û‡∏≤‡∏¢‡∏∏", "‡∏´‡∏°‡∏≠‡∏Å", "‡πÅ‡∏î‡∏î‡∏≠‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ù‡∏ô‡∏ï‡∏Å"], a: 2 },
        { q: "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏°‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠", "‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÉ‡∏ï‡πâ", "‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å"], a: 1 },
        { q: "Actias neidhoederi ‡∏≠‡∏≠‡∏Å‡∏´‡∏≤‡∏Å‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏î?", o: ["‡πÄ‡∏ä‡πâ‡∏≤‡∏ï‡∏£‡∏π‡πà", "‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", "‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô"], a: 2 },
        { q: "‡∏Ñ‡∏≤‡∏õ‡∏¥‡∏ö‡∏≤‡∏£‡πà‡∏≤‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ã‡∏≤‡∏Å‡∏õ‡∏£‡∏±‡∏Å‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏á", "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ô‡πâ‡∏≥", "‡∏ä‡∏≤‡∏¢‡∏´‡∏≤‡∏î"], a: 0 },
        { q: "‡πÉ‡∏Ñ‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á (‡∏™‡∏∏‡∏ô‡∏±‡∏Ç)?", o: ["‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πà", "‡πÇ‡∏à‡∏ô", "‡πÅ‡∏≠‡∏ô‡∏î‡∏£‡∏π‡∏ß‡πå"], a: 1 },
        { q: "‡∏ï‡∏Å‡∏õ‡∏•‡∏≤‡∏≠‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥", "‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö", "‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£"], a: 2 },
        { q: "‡πÇ‡∏ã‡∏ô‡∏ö‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏û‡∏∏‡∏£‡πâ‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ó‡∏≤‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠", "‡∏ó‡∏≤‡∏á‡πÉ‡∏ï‡πâ", "‡∏ó‡∏≤‡∏á‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å"], a: 0 },
        { q: "‡∏î‡πâ‡∏ß‡∏á‡∏¢‡∏π‡∏ô‡∏¥‡∏Ñ‡∏≠‡∏£‡πå‡∏ô‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å", "‡∏ó‡∏∏‡πà‡∏á‡∏´‡∏ç‡πâ‡∏≤", "‡∏õ‡πà‡∏≤"], a: 0 },
        { q: "‡∏ô‡∏Å‡πÅ‡∏Å‡πâ‡∏ß‡∏°‡∏≤‡∏Ñ‡∏≠‡∏ß‡πå‡∏™‡∏µ‡∏Ñ‡∏£‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏î?", o: ["‡∏õ‡∏•‡∏≤", "‡πÅ‡∏°‡∏•‡∏á", "‡∏ô‡∏Å"], a: 2 },
        { q: "‡∏õ‡∏•‡∏≤‡∏Ñ‡∏≤‡∏£‡πå‡∏õ‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ô‡πâ‡∏≥‡∏à‡∏∑‡∏î", "‡∏ô‡πâ‡∏≥‡πÄ‡∏Ñ‡πá‡∏°", "‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏ó‡∏∏‡πà‡∏á‡∏´‡∏ç‡πâ‡∏≤"], a: 2 },
        { q: "NPC ‡∏ß‡∏¥‡∏•‡∏•‡πå ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏∞‡πÄ‡∏•", "‡∏ö‡∏ô‡∏†‡∏π‡πÄ‡∏Ç‡∏≤", "‡πÉ‡∏ô‡∏õ‡πà‡∏≤"], a: 0 },
        { q: "‡∏õ‡∏∏‡πà‡∏° '‡∏õ‡∏•‡∏≤' ‡∏™‡∏µ‡∏≠‡∏∞‡πÑ‡∏£?", o: ["‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", "‡∏ü‡πâ‡∏≤", "‡∏™‡πâ‡∏°"], a: 1 },
        { q: "‡∏ú‡∏∂‡πâ‡∏á‡∏ö‡∏±‡∏°‡πÄ‡∏ö‡∏¥‡∏•‡∏ö‡∏µ‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö", "‡∏ó‡∏∏‡πà‡∏á‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ", "‡∏ñ‡πâ‡∏≥"], a: 1 },
        { q: "‡∏ô‡∏≤‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏õ‡∏£‡∏∞‡∏†‡∏≤‡∏Ñ‡∏≤‡∏£", "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏°‡∏á", "‡∏ã‡∏≤‡∏Å‡∏õ‡∏£‡∏±‡∏Å‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏á"], a: 1 },
        { q: "‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ö:", o: ["‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ô‡πâ‡∏≥", "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô", "‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠"], a: 0 },
        { q: "‡∏õ‡∏•‡∏≤‡∏™‡∏°‡∏¥‡∏•‡∏ó‡πå‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏ó‡∏∏‡πà‡∏á‡∏´‡∏ç‡πâ‡∏≤", "‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏™‡∏π‡∏á", "‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£"], a: 0 },
        { q: "‡πÅ‡∏≠‡∏ô‡∏ô‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏•‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡∏≠‡∏á", "‡∏ä‡∏≤‡∏¢‡∏´‡∏≤‡∏î", "‡∏õ‡πà‡∏≤"], a: 0 },
        { q: "‡∏•‡∏≤‡∏°‡∏∞‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏´‡∏≤‡∏î‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á", "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤", "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥"], a: 0 },
        { q: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏° 20 ‡πÉ‡∏´‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", o: ["5", "0", "20"], a: 2 },
        { q: "‡πÄ‡∏Ñ‡∏£‡∏¢‡πå‡∏ü‡∏¥‡∏ä‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏õ‡πà‡∏≤", "‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£", "‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏á‡∏ö"], a: 0 },
        { q: "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏õ‡∏•‡∏≤‡∏ß‡∏≤‡∏¨‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡πÉ‡∏ï‡πâ", "‡πÄ‡∏´‡∏ô‡∏∑‡∏≠", "‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å"], a: 2 },
        { q: "Maptopia ‡∏°‡∏µ‡πÑ‡∏ß‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?", o: ["‡∏Ç‡∏≤‡∏¢‡πÑ‡∏≠‡πÄ‡∏ó‡∏°", "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£", "‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏°"], a: 1 },
        { q: "‡∏ô‡∏Å‡∏≠‡∏∏‡πâ‡∏°‡∏ö‡∏≤‡∏ï‡∏£‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", o: ["‡∏ô‡∏Å", "‡∏õ‡∏•‡∏≤", "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô"], a: 0 },
        { q: "‡∏Å‡∏ß‡∏≤‡∏á‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡∏ä‡∏≤‡∏¢‡∏´‡∏≤‡∏î", "‡∏õ‡πà‡∏≤‡πÇ‡∏≠‡πä‡∏Ñ", "‡πÄ‡∏°‡∏∑‡∏≠‡∏á"], a: 1 },
        { q: "‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ Citron ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", o: ["‡∏ú‡∏•‡πÑ‡∏°‡πâ", "‡πÅ‡∏°‡∏•‡∏á", "‡∏õ‡∏•‡∏≤"], a: 1 },
        { q: "‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", o: ["‡πÄ‡∏´‡∏ô‡∏∑‡∏≠", "‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å", "‡πÉ‡∏ï‡πâ"], a: 1 },
        { q: "‡∏ö‡πä‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", o: ["‡∏™‡∏±‡∏ï‡∏ß‡πå", "NPC", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà"], a: 1 }
    ];
    let currentQ = 0;

    function openQuiz() {
        currentQ = 0;
        document.getElementById('quiz-container').style.display = 'block';
        showQuestion();
    }

    function closeQuiz() {
        document.getElementById('quiz-container').style.display = 'none';
    }

    function showQuestion() {
        let q = heartopiaQuestions[currentQ];
        document.getElementById('quiz-question').innerText = `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà ${currentQ + 1}/30 : ${q.q}`;
        let optContainer = document.getElementById('quiz-options');
        optContainer.innerHTML = "";
        document.getElementById('quiz-feedback').innerText = "";
        q.o.forEach((opt, i) => {
            let btn = document.createElement('div');
            btn.className = 'quiz-option';
            btn.innerText = opt;
            btn.onclick = () => {
                if(i === q.a) {
                   
                    document.getElementById('quiz-feedback').innerText = "‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!";
                    document.getElementById('quiz-feedback').style.color = "green";
                    setTimeout(() => {
                        currentQ++;
                        if(currentQ < 30) 
                        showQuestion();
                        else finishQuiz();
                    }, 1000);
                } else {
                    document.getElementById('quiz-feedback').innerText = "‚ùå ‡∏ú‡∏¥‡∏î!";
           
                    document.getElementById('quiz-feedback').style.color = "red";
                }
            };
            optContainer.appendChild(btn);
        });
    }

    function finishQuiz() {
        document.getElementById('quiz-question').innerText = "üèÜ ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á!";
        document.getElementById('quiz-options').innerHTML = "<p>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å Heartopia ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ</p>";
        document.getElementById('quiz-feedback').innerText = "";
    }
</script>
</body>
</html>